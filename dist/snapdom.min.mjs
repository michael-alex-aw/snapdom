var h={image:new Map,background:new Map,resource:new Map,defaultStyle:new Map,baseStyle:new Map,computedStyle:new WeakMap,font:new Set,session:{styleMap:new Map,styleCache:new WeakMap,nodeMap:new Map}};function lt(t="soft"){switch(t){case"auto":{h.session.styleMap=new Map,h.session.nodeMap=new Map;return}case"soft":{h.session.styleMap=new Map,h.session.nodeMap=new Map,h.session.styleCache=new WeakMap;return}case"full":return;case"disabled":{h.session.styleMap=new Map,h.session.nodeMap=new Map,h.session.styleCache=new WeakMap,h.computedStyle=new WeakMap,h.baseStyle=new Map,h.defaultStyle=new Map,h.image=new Map,h.background=new Map,h.resource=new Map,h.font=new Set;return}default:{h.session.styleMap=new Map,h.session.nodeMap=new Map,h.session.styleCache=new WeakMap;return}}}function G(t){let e=t.match(/url\((['"]?)(.*?)(\1)\)/);if(!e)return null;let n=e[2].trim();return n.startsWith("#")?null:n}function kt(t){if(!t||t==="none")return"";let e=t.replace(/translate[XY]?\([^)]*\)/g,"");return e=e.replace(/matrix\(([^)]+)\)/g,(n,o)=>{let r=o.split(",").map(i=>i.trim());return r.length!==6?`matrix(${o})`:(r[4]="0",r[5]="0",`matrix(${r.join(", ")})`)}),e=e.replace(/matrix3d\(([^)]+)\)/g,(n,o)=>{let r=o.split(",").map(i=>i.trim());return r.length!==16?`matrix3d(${o})`:(r[12]="0",r[13]="0",`matrix3d(${r.join(", ")})`)}),e.trim().replace(/\s{2,}/g," ")}function rt(t){if(/%[0-9A-Fa-f]{2}/.test(t))return t;try{return encodeURI(t)}catch{return t}}function ae(t="[snapDOM]",{ttlMs:e=5*6e4,maxEntries:n=12}={}){let o=new Map,r=0;function i(s,a,f){if(r>=n)return;let c=Date.now();(o.get(a)||0)>c||(o.set(a,c+e),r++,s==="warn"&&console&&console.warn?console.warn(`${t} ${f}`):console&&console.error&&console.error(`${t} ${f}`))}return{warnOnce(s,a){i("warn",s,a)},errorOnce(s,a){i("error",s,a)},reset(){o.clear(),r=0}}}var Ot=ae("[snapDOM]",{ttlMs:3*6e4,maxEntries:10}),At=new Map,ft=new Map;function ie(t){return/^data:|^blob:|^about:blank$/.test(t)}function ce(t,e){if(!e||ie(t))return!1;try{let n=typeof location<"u"&&location.href?location.href:"http://localhost/",o=new URL(t,n);return typeof location<"u"?o.origin!==location.origin:!0}catch{return!!e}}function le(t,e){if(!e)return t;if(e.includes("{url}"))return e.replace("{url}",encodeURIComponent(t));let n=e.endsWith("?")?"":e.includes("?")?"&":"?";return`${e}${n}url=${encodeURIComponent(t)}`}function fe(t){return new Promise((e,n)=>{let o=new FileReader;o.onload=()=>e(String(o.result||"")),o.onerror=()=>n(new Error("read_failed")),o.readAsDataURL(t)})}function ue(t,e){return[e.as||"blob",e.timeout??3e3,e.useProxy||"",e.errorTTL??8e3,t].join("|")}async function O(t,e={}){let n=e.as??"blob",o=e.timeout??3e3,r=e.useProxy||"",i=e.errorTTL??8e3,s=e.headers||{},a=!!e.silent,f=ue(t,{as:n,timeout:o,useProxy:r,errorTTL:i}),c=ft.get(f);if(c&&c.until>Date.now())return{...c.result,fromCache:!0};c&&ft.delete(f);let l=At.get(f);if(l)return l;let d=ce(t,r)?le(t,r):t,x=d.includes("?")?"&":"?";d+=`${x}t=${Date.now()}`;let L=e.credentials;if(!L)try{let k=typeof location<"u"&&location.href?location.href:"http://localhost/",$=new URL(t,k);L=typeof location<"u"&&$.origin===location.origin?"include":"omit"}catch{L="omit"}let S=new AbortController,C=setTimeout(()=>S.abort("timeout"),o),v=(async()=>{try{let k=await fetch(d,{signal:S.signal,credentials:L,headers:s});if(!k.ok){let N={ok:!1,data:null,status:k.status,url:d,fromCache:!1,reason:"http_error"};if(ft.set(f,{until:Date.now()+i,result:N}),!a){let D=`${k.status} ${k.statusText||""}`.trim();Ot.warnOnce(`http:${k.status}:${n}:${new URL(t,location?.href??"http://localhost/").origin}`,`HTTP error ${D} while fetching ${n} ${t}`)}return e.onError&&e.onError(N),N}if(n==="text")return{ok:!0,data:await k.text(),status:k.status,url:d,fromCache:!1};let $=await k.blob(),T=$.type||k.headers.get("content-type")||"";return n==="dataURL"?{ok:!0,data:await fe($),status:k.status,url:d,fromCache:!1,mime:T}:{ok:!0,data:$,status:k.status,url:d,fromCache:!1,mime:T}}catch(k){let $=k&&typeof k=="object"&&"name"in k&&k.name==="AbortError"?String(k.message||"").includes("timeout")?"timeout":"abort":"network",T={ok:!1,data:null,status:0,url:d,fromCache:!1,reason:$};if(ft.set(f,{until:Date.now()+i,result:T}),!a){let N=`${$}:${n}:${new URL(t,location?.href??"http://localhost/").origin}`,D=$==="timeout"?`Timeout after ${o}ms. Consider increasing timeout or using a proxy for ${t}`:$==="abort"?`Request aborted while fetching ${n} ${t}`:`Network/CORS issue while fetching ${n} ${t}. A proxy may be required`;Ot.errorOnce(N,D)}return e.onError&&e.onError(T),T}finally{clearTimeout(C),At.delete(f)}})();return At.set(f,v),v}function Y(t,e){if(!e||!t.width||!t.height)return t;let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let o=n.getContext("2d");return o.fillStyle=e,o.fillRect(0,0,n.width,n.height),o.drawImage(t,0,0),n}async function J(t,e={}){if(/^((repeating-)?(linear|radial|conic)-gradient)\(/i.test(t)||t.trim()==="none")return t;let o=G(t);if(!o)return t;let r=rt(o);if(h.background.has(r)){let i=h.background.get(r);return i?`url("${i}")`:"none"}try{let i=await O(r,{as:"dataURL",useProxy:e.useProxy});return i.ok?(h.background.set(r,i.data),`url("${i.data}")`):(h.background.set(r,null),"none")}catch{return h.background.set(r,null),"none"}}var ut=new Set(["meta","script","noscript","title","link","template"]),nt=new Set(["meta","link","style","title","noscript","script","template","g","defs","use","marker","mask","clipPath","pattern","path","polygon","polyline","line","circle","ellipse","rect","filter","lineargradient","radialgradient","stop"]),de=["div","span","p","a","img","ul","li","button","input","select","textarea","label","section","article","header","footer","nav","main","aside","h1","h2","h3","h4","h5","h6","table","thead","tbody","tr","td","th"];function $t(){for(let t of de){let e=String(t).toLowerCase();ut.has(e)||nt.has(e)||Et(e)}}function Et(t){if(t=String(t).toLowerCase(),nt.has(t)){let i={};return h.defaultStyle.set(t,i),i}if(h.defaultStyle.has(t))return h.defaultStyle.get(t);let e=document.getElementById("snapdom-sandbox");e||(e=document.createElement("div"),e.id="snapdom-sandbox",e.setAttribute("data-snapdom-sandbox","true"),e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.style.width="0px",e.style.height="0px",e.style.overflow="hidden",document.body.appendChild(e));let n=document.createElement(t);n.style.all="initial",e.appendChild(n);let o=getComputedStyle(n),r={};for(let i of o){if(Dt(i))continue;let s=o.getPropertyValue(i);r[i]=s}return e.removeChild(n),h.defaultStyle.set(t,r),r}var he=/(?:^|-)(animation|transition)(?:-|$)/i,me=/^(--|view-timeline|scroll-timeline|animation-trigger|offset-|position-try|app-region|interactivity|overlay|view-transition|-webkit-locale|-webkit-user-(?:drag|modify)|-webkit-tap-highlight-color|-webkit-text-security)$/i,pe=new Set(["cursor","pointer-events","touch-action","user-select","print-color-adjust","speak","reading-flow","reading-order","anchor-name","anchor-scope","container-name","container-type","timeline-scope"]);function Dt(t){let e=String(t).toLowerCase();return!!(pe.has(e)||me.test(e)||he.test(e))}function ot(t,e){if(e=String(e||"").toLowerCase(),nt.has(e))return"";let n=[],o=Et(e);for(let[r,i]of Object.entries(t)){if(Dt(r))continue;let s=o[r];i&&i!==s&&n.push(`${r}:${i}`)}return n.sort(),n.join(";")}function Mt(t){let e=new Set;return t.nodeType!==Node.ELEMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE?[]:(t.tagName&&e.add(t.tagName.toLowerCase()),typeof t.querySelectorAll=="function"&&t.querySelectorAll("*").forEach(n=>e.add(n.tagName.toLowerCase())),Array.from(e))}function vt(t){let e=new Map;for(let o of t){let r=h.defaultStyle.get(o);if(!r)continue;let i=Object.entries(r).map(([s,a])=>`${s}:${a};`).sort().join("");i&&(e.has(i)||e.set(i,[]),e.get(i).push(o))}let n="";for(let[o,r]of e.entries())n+=`${r.join(",")} { ${o} }
`;return n}function Ft(t){let e=Array.from(new Set(t.values())).filter(Boolean).sort(),n=new Map,o=1;for(let r of e)n.set(r,`c${o++}`);return n}function Z(t,e=null){if(!(t instanceof Element))return window.getComputedStyle(t,e);let n=h.computedStyle.get(t);if(n||(n=new Map,h.computedStyle.set(t,n)),!n.has(e)){let o=window.getComputedStyle(t,e);n.set(e,o)}return n.get(e)}function Lt(t){let e=t.replace(/^['"]|['"]$/g,"");if(e.startsWith("\\"))try{return String.fromCharCode(parseInt(e.replace("\\",""),16))}catch{return e}return e}function dt(t){let e={};for(let n of t)e[n]=t.getPropertyValue(n);return e}function Q(t){let e=[],n=0,o=0;for(let r=0;r<t.length;r++){let i=t[r];i==="("&&n++,i===")"&&n--,i===","&&n===0&&(e.push(t.slice(o,r).trim()),o=r+1)}return e.push(t.slice(o).trim()),e}function V(t,{fast:e=!1}={}){if(e)return t();"requestIdleCallback"in window?requestIdleCallback(t,{timeout:50}):setTimeout(t,1)}function X(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}var qt=new WeakMap,Rt=new Map,Tt=0;function st(){Tt++}var jt=!1;function ge(t=document.documentElement){if(!jt){jt=!0;try{new MutationObserver(()=>st()).observe(t,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{new MutationObserver(()=>st()).observe(document.head,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch{}try{let e=document.fonts;e&&(e.addEventListener?.("loadingdone",st),e.ready?.then(()=>st()).catch(()=>{}))}catch{}}}function ye(t){let e={},n=t.getPropertyValue("visibility");for(let o=0;o<t.length;o++){let r=t[o],i=t.getPropertyValue(r);(r==="background-image"||r==="content")&&i.includes("url(")&&!i.includes("data:")&&(i="none"),e[r]=i}return n==="hidden"&&(e.opacity="0"),e}var Ht=new WeakMap;function we(t){let e=Ht.get(t);return e||(e=Object.entries(t).sort((o,r)=>o[0]<r[0]?-1:o[0]>r[0]?1:0).map(([o,r])=>`${o}:${r}`).join(";"),Ht.set(t,e),e)}function be(t,e=null){let n=qt.get(t);if(n&&n.epoch===Tt)return n.snapshot;let o=e||getComputedStyle(t),r=ye(o);return qt.set(t,{epoch:Tt,snapshot:r}),r}function Se(t,e){return t&&t.session&&t.persist?t:t&&(t.styleMap||t.styleCache||t.nodeMap)?{session:t,persist:{snapshotKeyCache:Rt,defaultStyle:h.defaultStyle,baseStyle:h.baseStyle,image:h.image,resource:h.resource,background:h.background,font:h.font},options:e||{}}:{session:h.session,persist:{snapshotKeyCache:Rt,defaultStyle:h.defaultStyle,baseStyle:h.baseStyle,image:h.image,resource:h.resource,background:h.background,font:h.font},options:t||e||{}}}async function tt(t,e,n,o){if(t.tagName==="STYLE")return;let r=Se(n,o),i=r.options&&r.options.cache||"auto";if(i!=="disabled"&&ge(document.documentElement),i==="disabled"&&!r.session.__bumpedForDisabled&&(st(),Rt.clear(),r.session.__bumpedForDisabled=!0),nt.has(t.tagName?.toLowerCase())){let x=t.getAttribute?.("style");x&&e.setAttribute("style",x)}let{session:s,persist:a}=r;s.styleCache.has(t)||s.styleCache.set(t,getComputedStyle(t));let f=s.styleCache.get(t),c=be(t,f),l=we(c),d=a.snapshotKeyCache.get(l);if(!d){let x=t.tagName?.toLowerCase()||"div";d=ot(c,x),a.snapshotKeyCache.set(l,d)}s.styleMap.set(e,d)}function Nt(t,e,n){return Promise.all(t.map(o=>new Promise(r=>{function i(){V(s=>{(s&&typeof s.timeRemaining=="function"?s.timeRemaining()>0:!0)?e(o,r):i()},{fast:n})}i()})))}function xe(t){return t=t.trim(),!t||/\:not\(\s*\[data-sd-slotted\]\s*\)\s*$/.test(t)?t:`${t}:not([data-sd-slotted])`}function Ce(t,e,n=!0){return t.split(",").map(o=>o.trim()).filter(Boolean).map(o=>{if(o.startsWith(":where(")||o.startsWith("@"))return o;let r=n?xe(o):o;return`:where(${e} ${r})`}).join(", ")}function ke(t,e){return t?(t=t.replace(/:host\(([^)]+)\)/g,(n,o)=>`:where(${e}:is(${o.trim()}))`),t=t.replace(/:host\b/g,`:where(${e})`),t=t.replace(/:host-context\(([^)]+)\)/g,(n,o)=>`:where(:where(${o.trim()}) ${e})`),t=t.replace(/::slotted\(([^)]+)\)/g,(n,o)=>`:where(${e} ${o.trim()})`),t=t.replace(/(^|})(\s*)([^@}{]+){/g,(n,o,r,i)=>{let s=Ce(i,e,!0);return`${o}${r}${s}{`}),t):""}function Ae(t){return t.shadowScopeSeq=(t.shadowScopeSeq||0)+1,`s${t.shadowScopeSeq}`}function $e(t){let e="";try{t.querySelectorAll("style").forEach(o=>{e+=(o.textContent||"")+`
`});let n=t.adoptedStyleSheets||[];for(let o of n)try{if(o&&o.cssRules)for(let r of o.cssRules)e+=r.cssText+`
`}catch{}}catch{}return e}function Ee(t,e,n){if(!e)return;let o=document.createElement("style");o.setAttribute("data-sd",n),o.textContent=e,t.insertBefore(o,t.firstChild||null)}function Me(t,e){try{let n=t.currentSrc||t.src||"";if(!n)return;e.setAttribute("src",n),e.removeAttribute("srcset"),e.removeAttribute("sizes"),e.loading="eager",e.decoding="sync"}catch{}}function ve(t){let e=new Set;if(!t)return e;let n=/var\(\s*(--[A-Za-z0-9_-]+)\b/g,o;for(;o=n.exec(t);)e.add(o[1]);return e}function Fe(t,e){try{let o=getComputedStyle(t).getPropertyValue(e).trim();if(o)return o}catch{}try{let o=getComputedStyle(document.documentElement).getPropertyValue(e).trim();if(o)return o}catch{}return""}function Le(t,e,n){let o=[];for(let r of e){let i=Fe(t,r);i&&o.push(`${r}: ${i};`)}return o.length?`${n}{${o.join("")}}
`:""}function Re(t){t&&(t.nodeType===Node.ELEMENT_NODE&&t.setAttribute("data-sd-slotted",""),t.querySelectorAll&&t.querySelectorAll("*").forEach(e=>e.setAttribute("data-sd-slotted","")))}async function Te(t,e=3){let n=()=>{try{return t.contentDocument||t.contentWindow?.document||null}catch{return null}},o=n(),r=0;for(;r<e&&(!o||!o.body&&!o.documentElement);)await new Promise(i=>setTimeout(i,0)),o=n(),r++;return o&&(o.body||o.documentElement)?o:null}function Ne(t){let e=t.getBoundingClientRect(),n=0,o=0,r=0,i=0;try{let f=getComputedStyle(t);n=parseFloat(f.borderLeftWidth)||0,o=parseFloat(f.borderRightWidth)||0,r=parseFloat(f.borderTopWidth)||0,i=parseFloat(f.borderBottomWidth)||0}catch{}let s=Math.max(0,Math.round(e.width-(n+o))),a=Math.max(0,Math.round(e.height-(r+i)));return{contentWidth:s,contentHeight:a,rect:e}}function Ie(t,e,n){let o=t.createElement("style");return o.setAttribute("data-sd-iframe-pin",""),o.textContent=`html, body {margin: 0 !important;padding: 0 !important;width: ${e}px !important;height: ${n}px !important;min-width: ${e}px !important;min-height: ${n}px !important;box-sizing: border-box !important;overflow: hidden !important;background-clip: border-box !important;}`,(t.head||t.documentElement).appendChild(o),()=>{try{o.remove()}catch{}}}async function Pe(t,e,n){let o=await Te(t,3);if(!o)throw new Error("iframe document not accessible/ready");let{contentWidth:r,contentHeight:i,rect:s}=Ne(t),a=n?.snap;if(!a||typeof a.toPng!="function")throw new Error("snapdom.toPng not available in iframe or window");let f={...n,scale:1},c=Ie(o,r,i),l;try{l=await a.toPng(o.documentElement,f)}finally{c()}l.style.display="block",l.style.width=`${r}px`,l.style.height=`${i}px`;let d=document.createElement("div");return e.nodeMap.set(d,t),tt(t,d,e,n),d.style.overflow="hidden",d.style.display="block",d.style.width||(d.style.width=`${Math.round(s.width)}px`),d.style.height||(d.style.height=`${Math.round(s.height)}px`),d.appendChild(l),d}async function at(t,e,n){if(!t)throw new Error("Invalid node");let o=new Set,r=null,i=null;if(t.nodeType===Node.ELEMENT_NODE){let c=(t.localName||t.tagName||"").toLowerCase();if(t.id==="snapdom-sandbox"||t.hasAttribute("data-snapdom-sandbox")||ut.has(c))return null}if(t.nodeType===Node.TEXT_NODE||t.nodeType!==Node.ELEMENT_NODE)return t.cloneNode(!0);if(t.getAttribute("data-capture")==="exclude"){let c=document.createElement("div"),l=t.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${l.width}px;height:${l.height}px;visibility:hidden;`,c}if(n.exclude&&Array.isArray(n.exclude))for(let c of n.exclude)try{if(t.matches?.(c)){let l=document.createElement("div"),d=t.getBoundingClientRect();return l.style.cssText=`display:inline-block;width:${d.width}px;height:${d.height}px;visibility:hidden;`,l}}catch(l){console.warn(`Invalid selector in exclude option: ${c}`,l)}if(typeof n.filter=="function")try{if(!n.filter(t)){let c=document.createElement("div"),l=t.getBoundingClientRect();return c.style.cssText=`display:inline-block;width:${l.width}px;height:${l.height}px;visibility:hidden;`,c}}catch(c){console.warn("Error in filter function:",c)}if(t.tagName==="IFRAME"){let c=!1;try{c=!!(t.contentDocument||t.contentWindow?.document)}catch{c=!1}if(c)try{return await Pe(t,e,n)}catch(l){console.warn("[SnapDOM] iframe rasterization failed, fallback:",l)}if(n.placeholders){let l=document.createElement("div");return l.style.cssText=`width:${t.offsetWidth}px;height:${t.offsetHeight}px;background-image:repeating-linear-gradient(45deg,#ddd,#ddd 5px,#f9f9f9 5px,#f9f9f9 10px);display:flex;align-items:center;justify-content:center;font-size:12px;color:#555;border:1px solid #aaa;`,tt(t,l,e,n),l}else{let l=t.getBoundingClientRect(),d=document.createElement("div");return d.style.cssText=`display:inline-block;width:${l.width}px;height:${l.height}px;visibility:hidden;`,tt(t,d,e,n),d}}if(t.getAttribute("data-capture")==="placeholder"){let c=t.cloneNode(!1);e.nodeMap.set(c,t),tt(t,c,e,n);let l=document.createElement("div");return l.textContent=t.getAttribute("data-placeholder-text")||"",l.style.cssText="color:#666;font-size:12px;text-align:center;line-height:1.4;padding:0.5em;box-sizing:border-box;",c.appendChild(l),c}if(t.tagName==="CANVAS"){let c=t.toDataURL(),l=document.createElement("img");return l.src=c,l.width=t.width,l.height=t.height,e.nodeMap.set(l,t),tt(t,l,e,n),l}let s;try{if(s=t.cloneNode(!1),e.nodeMap.set(s,t),t.tagName==="IMG"){Me(t,s);try{let c=t.getBoundingClientRect(),l=Math.round(c.width||0),d=Math.round(c.height||0);if(!l||!d){let x=window.getComputedStyle(t),L=parseFloat(x.width)||0,S=parseFloat(x.height)||0,C=parseInt(t.getAttribute("width")||"",10)||0,v=parseInt(t.getAttribute("height")||"",10)||0,k=t.width||t.naturalWidth||0,$=t.height||t.naturalHeight||0;l=Math.round(l||L||C||k||0),d=Math.round(d||S||v||$||0)}l&&(s.dataset.snapdomWidth=String(l)),d&&(s.dataset.snapdomHeight=String(d))}catch{}}}catch(c){throw console.error("[Snapdom] Failed to clone node:",t,c),c}if(t instanceof HTMLTextAreaElement){let c=t.getBoundingClientRect();s.style.width=`${c.width}px`,s.style.height=`${c.height}px`}if(t instanceof HTMLInputElement&&(s.value=t.value,s.setAttribute("value",t.value),t.checked!==void 0&&(s.checked=t.checked,t.checked&&s.setAttribute("checked",""),t.indeterminate&&(s.indeterminate=t.indeterminate))),t instanceof HTMLSelectElement&&(r=t.value),t instanceof HTMLTextAreaElement&&(i=t.value),tt(t,s,e,n),t.shadowRoot){let v=function($,T){if($.nodeType===Node.ELEMENT_NODE&&$.tagName==="STYLE")return T(null);at($,e,n).then(N=>{T(N||null)}).catch(N=>{T(null)})};try{let $=t.shadowRoot.querySelectorAll("slot");for(let T of $){let N=[];try{N=T.assignedNodes?.({flatten:!0})||T.assignedNodes?.()||[]}catch{N=T.assignedNodes?.()||[]}for(let D of N)o.add(D)}}catch{}let c=Ae(e),l=`[data-sd="${c}"]`;try{s.setAttribute("data-sd",c)}catch{}let d=$e(t.shadowRoot),x=ke(d,l),L=ve(d),S=Le(t,L,l);Ee(s,S+x,c);let C=document.createDocumentFragment(),k=await Nt(Array.from(t.shadowRoot.childNodes),v,n.fast);C.append(...k.filter($=>!!$)),s.appendChild(C)}if(t.tagName==="SLOT"){let x=function(S,C){at(S,e,n).then(v=>{v&&Re(v),C(v||null)}).catch(v=>{C(null)})},c=t.assignedNodes?.({flatten:!0})||[],l=c.length>0?c:Array.from(t.childNodes),d=document.createDocumentFragment(),L=await Nt(Array.from(l),x,n.fast);return d.append(...L.filter(S=>!!S)),d}function a(c,l){if(o.has(c))return l(null);at(c,e,n).then(d=>{l(d||null)}).catch(d=>{l(null)})}let f=await Nt(Array.from(t.childNodes),a,n.fast);if(s.append(...f.filter(c=>!!c)),r!==null&&s instanceof HTMLSelectElement){s.value=r;for(let c of s.options)c.value===r?c.setAttribute("selected",""):c.removeAttribute("selected")}return i!==null&&s instanceof HTMLTextAreaElement&&(s.textContent=i),s}var _e=[/font\s*awesome/i,/material\s*icons/i,/ionicons/i,/glyphicons/i,/feather/i,/bootstrap\s*icons/i,/remix\s*icons/i,/heroicons/i,/layui/i,/lucide/i],It=[];function zt(t){let e=Array.isArray(t)?t:[t];for(let n of e)n instanceof RegExp?It.push(n):typeof n=="string"?It.push(new RegExp(n,"i")):console.warn("[snapdom] Ignored invalid iconFont value:",n)}function H(t){let e=typeof t=="string"?t:"",n=[..._e,...It];for(let o of n)if(o instanceof RegExp&&o.test(e))return!0;return!!(/icon/i.test(e)||/glyph/i.test(e)||/symbols/i.test(e)||/feather/i.test(e)||/fontawesome/i.test(e))}async function Vt(t,e,n,o=32,r="#000"){e=e.replace(/^['"]+|['"]+$/g,"");let i=window.devicePixelRatio||1;await document.fonts.ready;let s=document.createElement("span");s.textContent=t,s.style.position="absolute",s.style.visibility="hidden",s.style.fontFamily=`"${e}"`,s.style.fontWeight=n||"normal",s.style.fontSize=`${o}px`,s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.padding="0",s.style.margin="0",document.body.appendChild(s);let a=s.getBoundingClientRect(),f=Math.ceil(a.width),c=Math.ceil(a.height);document.body.removeChild(s);let l=document.createElement("canvas");l.width=f*i,l.height=c*i;let d=l.getContext("2d");return d.scale(i,i),d.font=n?`${n} ${o}px "${e}"`:`${o}px "${e}"`,d.textAlign="left",d.textBaseline="top",d.fillStyle=r,d.fillText(t,0,0),{dataUrl:l.toDataURL(),width:f,height:c}}var Ue=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","emoji","math","fangsong","ui-serif","ui-sans-serif","ui-monospace","ui-rounded"]);function ht(t){if(!t)return"";for(let e of t.split(",")){let n=e.trim().replace(/^['"]+|['"]+$/g,"");if(n&&!Ue.has(n.toLowerCase()))return n}return""}function mt(t){let e=String(t??"400").trim().toLowerCase();if(e==="normal")return 400;if(e==="bold")return 700;let n=parseInt(e,10);return Number.isFinite(n)?Math.min(900,Math.max(100,n)):400}function Pt(t){let e=String(t??"normal").trim().toLowerCase();return e.startsWith("italic")?"italic":e.startsWith("oblique")?"oblique":"normal"}function We(t){let e=String(t??"100%").match(/(\d+(?:\.\d+)?)\s*%/);return e?Math.max(50,Math.min(200,parseFloat(e[1]))):100}function Be(t){let e=String(t||"400").trim(),n=e.match(/^(\d{2,3})\s+(\d{2,3})$/);if(n){let r=mt(n[1]),i=mt(n[2]);return{min:Math.min(r,i),max:Math.max(r,i)}}let o=mt(e);return{min:o,max:o}}function Oe(t){let e=String(t||"normal").trim().toLowerCase();return e==="italic"?{kind:"italic"}:e.startsWith("oblique")?{kind:"oblique"}:{kind:"normal"}}function De(t){let e=String(t||"100%").trim(),n=e.match(/(\d+(?:\.\d+)?)\s*%\s+(\d+(?:\.\d+)?)\s*%/);if(n){let i=parseFloat(n[1]),s=parseFloat(n[2]);return{min:Math.min(i,s),max:Math.max(i,s)}}let o=e.match(/(\d+(?:\.\d+)?)\s*%/),r=o?parseFloat(o[1]):100;return{min:r,max:r}}function qe(t,e){if(!t)return!1;try{let n=new URL(t,location.href);if(n.origin===location.origin)return!0;let r=n.host.toLowerCase();if(["fonts.googleapis.com","fonts.gstatic.com","use.typekit.net","p.typekit.net","kit.fontawesome.com","use.fontawesome.com"].some(a=>r.endsWith(a)))return!0;let s=(n.pathname+n.search).toLowerCase();if(/\bfont(s)?\b/.test(s)||/\.woff2?(\b|$)/.test(s))return!0;for(let a of e){let f=a.toLowerCase().replace(/\s+/g,"+"),c=a.toLowerCase().replace(/\s+/g,"-");if(s.includes(f)||s.includes(c))return!0}return!1}catch{return!1}}function je(t){let e=new Set;for(let n of t||[]){let o=String(n).split("__")[0]?.trim();o&&e.add(o)}return e}async function pt({required:t,usedCodepoints:e,exclude:n=void 0,localFonts:o=[],useProxy:r=""}={}){t instanceof Set||(t=new Set),e instanceof Set||(e=new Set);let i=new Map;for(let u of t){let[p,g,w,m]=String(u).split("__");if(!p)continue;let y=i.get(p)||[];y.push({w:parseInt(g,10),s:w,st:parseInt(m,10)}),i.set(p,y)}let s=/@import\s+url\(["']?([^"')]+)["']?\)/g,a=/url\((["']?)([^"')]+)\1\)/g,f=/@font-face[^{}]*\{[^}]*\}/g;function c(u,p,g,w){if(!i.has(u))return!1;let m=i.get(u),y=Be(g),A=Oe(p),b=De(w),M=y.min!==y.max,F=y.min,I=E=>A.kind==="normal"&&E==="normal"||A.kind!=="normal"&&(E==="italic"||E==="oblique"),W=!1;for(let E of m){let P=M?E.w>=y.min&&E.w<=y.max:E.w===F,B=I(Pt(E.s)),R=E.st>=b.min&&E.st<=b.max;if(P&&B&&R){W=!0;break}}if(W)return!0;if(!M)for(let E of m){let P=I(Pt(E.s)),B=E.st>=b.min&&E.st<=b.max;if(Math.abs(F-E.w)<=300&&P&&B)return!0}return!1}function l(u){if(!u)return[];let p=[],g=u.split(",").map(w=>w.trim()).filter(Boolean);for(let w of g){let m=w.match(/^U\+([0-9A-Fa-f?]+)(?:-([0-9A-Fa-f?]+))?$/);if(!m)continue;let y=m[1],A=m[2],b=M=>{if(!M.includes("?"))return parseInt(M,16);let F=parseInt(M.replace(/\?/g,"0"),16),I=parseInt(M.replace(/\?/g,"F"),16);return[F,I]};if(A){let M=b(y),F=b(A),I=Array.isArray(M)?M[0]:M,W=Array.isArray(F)?F[1]:F;p.push([Math.min(I,W),Math.max(I,W)])}else{let M=b(y);Array.isArray(M)?p.push([M[0],M[1]]):p.push([M,M])}}return p}function d(u,p){if(!p.length||!u||u.size===0)return!0;for(let g of u)for(let[w,m]of p)if(g>=w&&g<=m)return!0;return!1}function x(u,p){let g=[];if(!u)return g;for(let w of u.matchAll(a)){let m=(w[2]||"").trim();if(!(!m||m.startsWith("data:"))){if(!/^https?:/i.test(m))try{m=new URL(m,p||location.href).href}catch{}g.push(m)}}return g}async function L(u,p){let g=u;for(let w of u.matchAll(a)){let m=G(w[0]);if(!m)continue;let y=m;if(!y.startsWith("http")&&!y.startsWith("data:"))try{y=new URL(y,p||location.href).href}catch{}if(!H(y)){if(h.resource?.has(y)){h.font?.add(y),g=g.replace(w[0],`url(${h.resource.get(y)})`);continue}if(!h.font?.has(y))try{let A=await O(y,{as:"dataURL",useProxy:r,silent:!0});if(A.ok&&typeof A.data=="string"){let b=A.data;h.resource?.set(y,b),h.font?.add(y),g=g.replace(w[0],`url(${b})`)}}catch{console.warn("[snapDOM] Failed to fetch font resource:",y)}}}return g}function S(u){if(!u.length)return null;let p=(b,M)=>u.some(([F,I])=>!(I<b||F>M)),g=p(0,255)||p(305,305),w=p(256,591)||p(7680,7935),m=p(880,1023),y=p(1024,1279);return p(7840,7929)||p(258,259)||p(416,417)||p(431,432)?"vietnamese":y?"cyrillic":m?"greek":w?"latin-ext":g?"latin":null}function C(u={}){let p=new Set((u.families||[]).map(m=>String(m).toLowerCase())),g=new Set((u.domains||[]).map(m=>String(m).toLowerCase())),w=new Set((u.subsets||[]).map(m=>String(m).toLowerCase()));return(m,y)=>{if(p.size&&p.has(m.family.toLowerCase()))return!0;if(g.size)for(let A of m.srcUrls)try{if(g.has(new URL(A).host.toLowerCase()))return!0}catch{}if(w.size){let A=S(y);if(A&&w.has(A))return!0}return!1}}let v=C(n);function k(u){if(!u)return u;let p=/@font-face[^{}]*\{[^}]*\}/gi,g=new Set,w=[];for(let y of u.match(p)||[]){let A=y.match(/font-family:\s*([^;]+);/i)?.[1]||"",b=ht(A),M=(y.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),F=(y.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),I=(y.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),W=(y.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),E=(y.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),P=x(E,location.href),B=P.length?P.map(j=>String(j).toLowerCase()).sort().join("|"):E.toLowerCase(),R=[String(b||"").toLowerCase(),M,F,I,W.toLowerCase(),B].join("|");g.has(R)||(g.add(R),w.push(y))}if(w.length===0)return u;let m=0;return u.replace(p,()=>w[m++]||"")}function $(){let u=Array.from(t||[]).sort().join("|"),p=n?JSON.stringify({families:(n.families||[]).map(m=>String(m).toLowerCase()).sort(),domains:(n.domains||[]).map(m=>String(m).toLowerCase()).sort(),subsets:(n.subsets||[]).map(m=>String(m).toLowerCase()).sort()}):"",g=(o||[]).map(m=>`${(m.family||"").toLowerCase()}::${m.weight||"normal"}::${m.style||"normal"}::${m.src||""}`).sort().join("|");return`fonts-embed-css::req=${u}::ex=${p}::lf=${g}::px=${r||""}`}let T=$();if(h.resource?.has(T))return h.resource.get(T);let N=je(t),D=[];for(let u of document.querySelectorAll("style")){let p=u.textContent||"";for(let g of p.matchAll(s)){let w=g[1];if(!w||H(w))continue;!!document.querySelector(`link[rel="stylesheet"][href="${w}"]`)||D.push(w)}}D.length&&await Promise.all(D.map(u=>new Promise(p=>{if(document.querySelector(`link[rel="stylesheet"][href="${u}"]`))return p(null);let g=document.createElement("link");g.rel="stylesheet",g.href=u,g.setAttribute("data-snapdom","injected-import"),g.onload=()=>p(g),g.onerror=()=>p(null),document.head.appendChild(g)})));let U="",q=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(u=>!!u.href);for(let u of q)try{if(H(u.href))continue;let p="",g=!1;try{g=new URL(u.href,location.href).origin===location.origin}catch{}if(!g&&!qe(u.href,N))continue;if(g){let m=Array.from(document.styleSheets).find(y=>y.href===u.href);if(m)try{let y=m.cssRules||[];p=Array.from(y).map(A=>A.cssText).join("")}catch{}}if(!p&&(p=(await O(u.href,{as:"text",useProxy:r})).data,H(u.href)))continue;let w="";for(let m of p.match(f)||[]){let y=(m.match(/font-family:\s*([^;]+);/i)?.[1]||"").trim(),A=ht(y);if(!A||H(A))continue;let b=(m.match(/font-weight:\s*([^;]+);/i)?.[1]||"400").trim(),M=(m.match(/font-style:\s*([^;]+);/i)?.[1]||"normal").trim(),F=(m.match(/font-stretch:\s*([^;]+);/i)?.[1]||"100%").trim(),I=(m.match(/unicode-range:\s*([^;]+);/i)?.[1]||"").trim(),W=(m.match(/src\s*:\s*([^;]+);/i)?.[1]||"").trim(),E=x(W,u.href);if(!c(A,M,b,F))continue;let P=l(I);if(!d(e,P))continue;let B={family:A,weightSpec:b,styleSpec:M,stretchSpec:F,unicodeRange:I,srcRaw:W,srcUrls:E,href:u.href};if(n&&v(B,P))continue;let R=/url\(/i.test(W)?await L(m,u.href):m;w+=R+""}w.trim()&&(U+=w+"")}catch{console.warn("[snapdom] Failed to process stylesheet:",u.href)}for(let u of document.styleSheets)try{if(u.href&&q.some(g=>g.href===u.href))continue;let p=u.cssRules||[];for(let g of p){if(g.type!==CSSRule.FONT_FACE_RULE)continue;let w=(g.style.getPropertyValue("font-family")||"").trim(),m=ht(w);if(!m||H(m))continue;let y=(g.style.getPropertyValue("font-weight")||"400").trim(),A=(g.style.getPropertyValue("font-style")||"normal").trim(),b=(g.style.getPropertyValue("font-stretch")||"100%").trim(),M=(g.style.getPropertyValue("src")||"").trim(),F=(g.style.getPropertyValue("unicode-range")||"").trim(),I=x(M,u.href||location.href);if(!c(m,A,y,b))continue;let W=l(F);if(!d(e,W))continue;let E={family:m,weightSpec:y,styleSpec:A,stretchSpec:b,unicodeRange:F,srcRaw:M,srcUrls:I,href:u.href||location.href};if(!(n&&v(E,W)))if(/url\(/i.test(M)){let P=await L(M,u.href||location.href);U+=`@font-face{font-family:${m};src:${P};font-style:${A};font-weight:${y};font-stretch:${b};${F?`unicode-range:${F};`:""}}`}else U+=`@font-face{font-family:${m};src:${M};font-style:${A};font-weight:${y};font-stretch:${b};${F?`unicode-range:${F};`:""}}`}}catch{}try{for(let u of document.fonts||[]){if(!u||!u.family||u.status!=="loaded"||!u._snapdomSrc)continue;let p=String(u.family).replace(/^['"]+|['"]+$/g,"");if(H(p)||!i.has(p)||n?.families&&n.families.some(w=>String(w).toLowerCase()===p.toLowerCase()))continue;let g=u._snapdomSrc;if(!String(g).startsWith("data:")){if(h.resource?.has(u._snapdomSrc))g=h.resource.get(u._snapdomSrc),h.font?.add(u._snapdomSrc);else if(!h.font?.has(u._snapdomSrc))try{let w=await O(u._snapdomSrc,{as:"dataURL",useProxy:r,silent:!0});if(w.ok&&typeof w.data=="string")g=w.data,h.resource?.set(u._snapdomSrc,g),h.font?.add(u._snapdomSrc);else continue}catch{console.warn("[snapdom] Failed to fetch dynamic font src:",u._snapdomSrc);continue}}U+=`@font-face{font-family:'${p}';src:url(${g});font-style:${u.style||"normal"};font-weight:${u.weight||"normal"};}`}}catch{}for(let u of o){if(!u||typeof u!="object")continue;let p=String(u.family||"").replace(/^['"]+|['"]+$/g,"");if(!p||H(p)||!i.has(p)||n?.families&&n.families.some(b=>String(b).toLowerCase()===p.toLowerCase()))continue;let g=u.weight!=null?String(u.weight):"normal",w=u.style!=null?String(u.style):"normal",m=u.stretchPct!=null?`${u.stretchPct}%`:"100%",y=String(u.src||""),A=y;if(!A.startsWith("data:")){if(h.resource?.has(y))A=h.resource.get(y),h.font?.add(y);else if(!h.font?.has(y))try{let b=await O(y,{as:"dataURL",useProxy:r,silent:!0});if(b.ok&&typeof b.data=="string")A=b.data,h.resource?.set(y,A),h.font?.add(y);else continue}catch{console.warn("[snapdom] Failed to fetch localFonts src:",y);continue}}U+=`@font-face{font-family:'${p}';src:url(${A});font-style:${w};font-weight:${g};font-stretch:${m};}`}return U&&(U=k(U),h.resource?.set(T,U)),U}function gt(t){let e=new Set;if(!t)return e;let n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null),o=s=>{let a=ht(s.fontFamily);if(!a)return;let f=(c,l,d)=>`${a}__${mt(c)}__${Pt(l)}__${We(d)}`;e.add(f(s.fontWeight,s.fontStyle,s.fontStretch))};o(getComputedStyle(t));let r=getComputedStyle(t,"::before");r&&r.content&&r.content!=="none"&&o(r);let i=getComputedStyle(t,"::after");for(i&&i.content&&i.content!=="none"&&o(i);n.nextNode();){let s=n.currentNode,a=getComputedStyle(s);o(a);let f=getComputedStyle(s,"::before");f&&f.content&&f.content!=="none"&&o(f);let c=getComputedStyle(s,"::after");c&&c.content&&c.content!=="none"&&o(c)}return e}function yt(t){let e=new Set,n=r=>{if(r)for(let i of r)e.add(i.codePointAt(0))},o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null);for(;o.nextNode();){let r=o.currentNode;if(r.nodeType===Node.TEXT_NODE)n(r.nodeValue||"");else if(r.nodeType===Node.ELEMENT_NODE){let i=r;for(let s of["::before","::after"]){let f=getComputedStyle(i,s)?.getPropertyValue("content");if(!(!f||f==="none"))if(/^"/.test(f)||/^'/.test(f))n(f.slice(1,-1));else{let c=f.match(/\\[0-9A-Fa-f]{1,6}/g);if(c)for(let l of c)try{e.add(parseInt(l.slice(1),16))}catch{}}}}}return e}async function wt(t,e=2){try{await document.fonts.ready}catch{}let n=Array.from(t||[]).filter(Boolean);if(n.length===0)return;let o=()=>{let r=document.createElement("div");r.style.cssText="position: absolute !important;left: -9999px !important;top: 0 !important;opacity: 0 !important;pointer-events: none !important;contain: layout size style;";for(let i of n){let s=document.createElement("span");s.textContent="AaBbGg1234\xC1\xC9\xCD\xD3\xDA\xE7\xF1\u2014\u221E",s.style.fontFamily=`"${i}"`,s.style.fontWeight="700",s.style.fontStyle="italic",s.style.fontSize="32px",s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.margin="0",s.style.padding="0",r.appendChild(s)}document.body.appendChild(r),r.offsetWidth,document.body.removeChild(r)};for(let r=0;r<Math.max(1,e);r++)o(),await new Promise(i=>requestAnimationFrame(()=>requestAnimationFrame(i)))}async function _t(t,e,n,o){if(!(t instanceof Element)||!(e instanceof Element))return;for(let s of["::before","::after","::first-letter"])try{let a=Z(t,s);if(!a||typeof a[Symbol.iterator]!="function"||a.content==="none"&&a.backgroundImage==="none"&&a.backgroundColor==="transparent"&&(a.borderStyle==="none"||parseFloat(a.borderWidth)===0)&&(!a.transform||a.transform==="none")&&a.display==="inline")continue;if(s==="::first-letter"){let E=getComputedStyle(t);if(!(a.color!==E.color||a.fontSize!==E.fontSize||a.fontWeight!==E.fontWeight))continue;let B=Array.from(e.childNodes).find(Bt=>Bt.nodeType===Node.TEXT_NODE&&Bt.textContent?.trim().length>0);if(!B)continue;let R=B.textContent,et=R.match(/^([^\p{L}\p{N}\s]*[\p{L}\p{N}](?:['’])?)/u)?.[0],Ct=R.slice(et?.length||0);if(!et||/[\uD800-\uDFFF]/.test(et))continue;let z=document.createElement("span");z.textContent=et,z.dataset.snapdomPseudo="::first-letter";let re=dt(a),se=ot(re,"span");n.styleMap.set(z,se);let Wt=document.createTextNode(Ct);e.replaceChild(Wt,B),e.insertBefore(z,Wt);continue}let c=a.content,l=/counter\s*\(|counters\s*\(/.test(c)?"- ":Lt(c),d=a.backgroundImage,x=a.backgroundColor,L=a.fontFamily,S=parseInt(a.fontSize)||32,C=parseInt(a.fontWeight)||!1,v=a.color||"#000",k=a.display,$=parseFloat(a.width),T=parseFloat(a.height),N=a.borderStyle,D=parseFloat(a.borderWidth),U=a.transform,q=H(L),u=c!=="none"&&l!=="",p=d&&d!=="none",g=x&&x!=="transparent"&&x!=="rgba(0, 0, 0, 0)",w=k!=="inline"&&($>0||T>0),m=N&&N!=="none"&&D>0,y=U&&U!=="none";if(!(u||p||g||w||m||y))continue;let b=document.createElement("span");b.dataset.snapdomPseudo=s,b.style.verticalAlign="middle";let M=dt(a),F=ot(M,"span");if(n.styleMap.set(b,F),q&&l.length===1){let{dataUrl:E,width:P,height:B}=await Vt(l,L,C,S,v),R=document.createElement("img");R.src=E,R.style=`height:${S}px;width:${P/B*S}px;object-fit:contain;`,b.appendChild(R),e.dataset.snapdomHasIcon="true"}else if(l.startsWith("url(")){let E=G(l);if(E?.trim())try{let P=document.createElement("img"),B=await O(rt(E),{as:"dataURL",useProxy:o.useProxy});P.src=B.data,P.style=`width:${S}px;height:auto;object-fit:contain;`,b.appendChild(P)}catch(P){console.error(`[snapdom] Error in pseudo ${s} for`,t,P)}}else!q&&u&&(b.textContent=l);if(p)try{let E=Q(d),P=await Promise.all(E.map(J));b.style.backgroundImage=P.join(", ")}catch(E){console.warn(`[snapdom] Failed to inline background-image for ${s}`,E)}if(g&&(b.style.backgroundColor=x),!(b.childNodes.length>0||b.textContent?.trim()!==""||p||g||w||m||y))continue;s==="::before"?e.insertBefore(b,e.firstChild):e.appendChild(b)}catch(a){console.warn(`[snapdom] Failed to capture ${s} for`,t,a)}let r=Array.from(t.children),i=Array.from(e.children).filter(s=>!s.dataset.snapdomPseudo);for(let s=0;s<Math.min(r.length,i.length);s++)await _t(r[s],i[s],n,o)}function Xt(t){if(!t)return;let e=new Set;if(t.querySelectorAll("use").forEach(a=>{let f=a.getAttribute("xlink:href")||a.getAttribute("href");f&&f.startsWith("#")&&e.add(f.slice(1))}),!e.size)return;let n=Array.from(document.querySelectorAll("svg > symbol, svg > defs")),o=n.filter(a=>a.tagName.toLowerCase()==="symbol"),r=n.filter(a=>a.tagName.toLowerCase()==="defs"),i=t.querySelector("svg.inline-defs-container");i||(i=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.setAttribute("aria-hidden","true"),i.setAttribute("style","position: absolute; width: 0; height: 0; overflow: hidden;"),i.classList.add("inline-defs-container"),t.insertBefore(i,t.firstChild));let s=new Set;t.querySelectorAll("symbol[id], defs > *[id]").forEach(a=>{s.add(a.id)}),e.forEach(a=>{if(s.has(a))return;let f=o.find(c=>c.id===a);if(f){i.appendChild(f.cloneNode(!0)),s.add(a);return}for(let c of r){let l=c.querySelector(`#${CSS.escape(a)}`);if(l){let d=i.querySelector("defs");d||(d=document.createElementNS("http://www.w3.org/2000/svg","defs"),i.appendChild(d)),d.appendChild(l.cloneNode(!0)),s.add(a);break}}})}async function Gt(t,e={}){let n={styleMap:h.session.styleMap,styleCache:h.session.styleCache,nodeMap:h.session.nodeMap},o,r="",i="";He(t);try{Xt(t)}catch(a){console.warn("inlineExternal defs or symbol failed:",a)}try{o=await at(t,n,e,t)}catch(a){throw console.warn("deepClone failed:",a),a}try{await _t(t,o,n,e)}catch(a){console.warn("inlinePseudoElements failed:",a)}await Ke(o);try{let a=o.querySelectorAll("style[data-sd]");for(let f of a)i+=f.textContent||"",f.remove()}catch{}let s=Ft(n.styleMap);r=Array.from(s.entries()).map(([a,f])=>`.${f}{${a}}`).join(""),r=i+r;for(let[a,f]of n.styleMap.entries()){if(a.tagName==="STYLE")continue;if(a.getRootNode&&a.getRootNode()instanceof ShadowRoot){a.setAttribute("style",f.replace(/;/g,"; "));continue}let c=s.get(f);c&&a.classList.add(c);let l=a.style?.backgroundImage,d=a.dataset?.snapdomHasIcon;l&&l!=="none"&&(a.style.backgroundImage=l),d&&(a.style.verticalAlign="middle",a.style.display="inline")}for(let[a,f]of n.nodeMap.entries()){let c=f.scrollLeft,l=f.scrollTop;if((c||l)&&a instanceof HTMLElement){a.style.overflow="hidden",a.style.scrollbarWidth="none",a.style.msOverflowStyle="none";let x=document.createElement("div");for(x.style.transform=`translate(${-c}px, ${-l}px)`,x.style.willChange="transform",x.style.display="inline-block",x.style.width="100%";a.firstChild;)x.appendChild(a.firstChild);a.appendChild(x)}}if(t===n.nodeMap.get(o)){let a=n.styleCache.get(t)||window.getComputedStyle(t);n.styleCache.set(t,a);let f=kt(a.transform);o.style.margin="0",o.style.position="static",o.style.top="auto",o.style.left="auto",o.style.right="auto",o.style.bottom="auto",o.style.zIndex="auto",o.style.float="none",o.style.clear="none",o.style.transform=f||""}for(let[a,f]of n.nodeMap.entries())f.tagName==="PRE"&&(a.style.marginTop="0",a.style.marginBlockStart="0");return{clone:o,classCSS:r,styleCache:n.styleCache}}function He(t){let e=getComputedStyle(t),n=e.outlineStyle,o=e.outlineWidth,r=e.borderStyle,i=e.borderWidth,s=n!=="none"&&parseFloat(o)>0,a=r==="none"||parseFloat(i)===0;s&&a&&(t.style.border=`${o} solid transparent`)}var it=new Map;async function ct(t){if(h.resource?.has(t))return h.resource.get(t);if(it.has(t))return it.get(t);let e=(async()=>{let n=await O(t,{as:"dataURL",silent:!0});if(!n.ok||typeof n.data!="string")throw new Error(`[snapDOM] Failed to read blob URL: ${t}`);return h.resource?.set(t,n.data),n.data})();it.set(t,e);try{let n=await e;return it.set(t,n),n}catch(n){throw it.delete(t),n}}var ze=/\bblob:[^)"'\s]+/g;async function Kt(t){if(!t||t.indexOf("blob:")===-1)return t;let e=Array.from(new Set(t.match(ze)||[]));if(e.length===0)return t;let n=t;for(let o of e)try{let r=await ct(o);n=n.split(o).join(r)}catch{}return n}function bt(t){return typeof t=="string"&&t.startsWith("blob:")}function Ve(t){return(t||"").split(",").map(e=>e.trim()).filter(Boolean).map(e=>{let n=e.match(/^(\S+)(\s+.+)?$/);return n?{url:n[1],desc:n[2]||""}:null}).filter(Boolean)}function Xe(t){return t.map(e=>e.desc?`${e.url} ${e.desc.trim()}`:e.url).join(", ")}async function Ke(t){if(!t)return;let e=t.querySelectorAll?t.querySelectorAll("img"):[];for(let s of e)try{let f=s.getAttribute("src")||s.currentSrc||"";if(bt(f)){let l=await ct(f);s.setAttribute("src",l)}let c=s.getAttribute("srcset");if(c&&c.includes("blob:")){let l=Ve(c),d=!1;for(let x of l)if(bt(x.url))try{x.url=await ct(x.url),d=!0}catch{}d&&s.setAttribute("srcset",Xe(l))}}catch{}let n=t.querySelectorAll?t.querySelectorAll("image"):[];for(let s of n)try{let a="http://www.w3.org/1999/xlink",f=s.getAttribute("href")||s.getAttributeNS?.(a,"href");if(bt(f)){let c=await ct(f);s.setAttribute("href",c),s.removeAttributeNS?.(a,"href")}}catch{}let o=t.querySelectorAll?t.querySelectorAll("[style*='blob:']"):[];for(let s of o)try{let a=s.getAttribute("style");if(a&&a.includes("blob:")){let f=await Kt(a);s.setAttribute("style",f)}}catch{}let r=t.querySelectorAll?t.querySelectorAll("style"):[];for(let s of r)try{let a=s.textContent||"";a.includes("blob:")&&(s.textContent=await Kt(a))}catch{}let i=["poster"];for(let s of i){let a=t.querySelectorAll?t.querySelectorAll(`[${s}^='blob:']`):[];for(let f of a)try{let c=f.getAttribute(s);bt(c)&&f.setAttribute(s,await ct(c))}catch{}}}async function Yt(t,e={}){let n=Array.from(t.querySelectorAll("img")),o=async r=>{if(!r.getAttribute("src")){let l=r.currentSrc||r.src||"";l&&r.setAttribute("src",l)}r.removeAttribute("srcset"),r.removeAttribute("sizes");let i=r.src||"";if(!i)return;let s=await O(i,{as:"dataURL",useProxy:e.useProxy});if(s.ok&&typeof s.data=="string"&&s.data.startsWith("data:")){r.src=s.data,r.width||(r.width=r.naturalWidth||100),r.height||(r.height=r.naturalHeight||100);return}let{defaultImageUrl:a}=e||{};if(a)try{let l=parseInt(r.dataset?.snapdomWidth||"",10)||0,d=parseInt(r.dataset?.snapdomHeight||"",10)||0,x=parseInt(r.getAttribute("width")||"",10)||0,L=parseInt(r.getAttribute("height")||"",10)||0,S=parseFloat(r.style?.width||"")||0,C=parseFloat(r.style?.height||"")||0,v=l||S||x||r.width||void 0,k=d||C||L||r.height||void 0,$=typeof a=="function"?await a({width:v,height:k,src:i,element:r}):a;if($){let T=await O($,{as:"dataURL",useProxy:e.useProxy});r.src=T.data,!r.width&&v&&(r.width=v),!r.height&&k&&(r.height=k),r.width||(r.width=r.naturalWidth||100),r.height||(r.height=r.naturalHeight||100);return}}catch{}let f=r.width||r.naturalWidth||100,c=r.height||r.naturalHeight||100;if(e.placeholders!==!1){let l=document.createElement("div");l.style.cssText=[`width:${f}px`,`height:${c}px`,"background:#ccc","display:inline-block","text-align:center",`line-height:${c}px`,"color:#666","font-size:12px","overflow:hidden"].join(";"),l.textContent="img",r.replaceWith(l)}else{let l=document.createElement("div");l.style.cssText=`display:inline-block;width:${f}px;height:${c}px;visibility:hidden;`,r.replaceWith(l)}};for(let r=0;r<n.length;r+=4){let i=n.slice(r,r+4).map(o);await Promise.allSettled(i)}}async function St(t,e,n,o={}){let r=[[t,e]],i=["background-image","mask","mask-image","-webkit-mask","-webkit-mask-image","mask-source","mask-box-image-source","mask-border-source","-webkit-mask-box-image-source","border-image","border-image-source"],s=["mask-position","mask-size","mask-repeat","-webkit-mask-position","-webkit-mask-size","-webkit-mask-repeat","mask-origin","mask-clip","-webkit-mask-origin","-webkit-mask-clip","-webkit-mask-position-x","-webkit-mask-position-y"],a=["border-image-slice","border-image-width","border-image-outset","border-image-repeat"];for(;r.length;){let[f,c]=r.shift(),l=n.get(f)||Z(f);n.has(f)||n.set(f,l);let d=(()=>{let S=l.getPropertyValue("border-image"),C=l.getPropertyValue("border-image-source");return S&&S!=="none"||C&&C!=="none"})();for(let S of i){let C=l.getPropertyValue(S);if(!C||C==="none")continue;let v=Q(C),k=await Promise.all(v.map($=>J($,o)));k.some($=>$&&$!=="none"&&!/^url\(undefined/.test($))&&c.style.setProperty(S,k.join(", "))}for(let S of s){let C=l.getPropertyValue(S);!C||C==="initial"||c.style.setProperty(S,C)}if(d)for(let S of a){let C=l.getPropertyValue(S);!C||C==="initial"||c.style.setProperty(S,C)}let x=Array.from(f.children),L=Array.from(c.children);for(let S=0;S<Math.min(x.length,L.length);S++)r.push([x[S],L[S]])}}async function Zt(t,e){if(!t)throw new Error("Element cannot be null or undefined");lt(e.cache);let n=e.fast,o,r,i,s="",a="",f,c;({clone:o,classCSS:r,styleCache:i}=await Gt(t,e)),await new Promise(L=>{V(async()=>{await Yt(o,e),L()},{fast:n})}),await new Promise(L=>{V(async()=>{await St(t,o,i,e),L()},{fast:n})}),e.embedFonts&&await new Promise(L=>{V(async()=>{let S=gt(t),C=yt(t);if(X){let v=new Set(Array.from(S).map(k=>String(k).split("__")[0]).filter(Boolean));await wt(v,5)}s=await pt({required:S,usedCodepoints:C,preCached:!1,exclude:e.excludeFonts,useProxy:e.useProxy}),L()},{fast:n})});let l=Mt(o).sort(),d=l.join(",");h.baseStyle.has(d)?a=h.baseStyle.get(d):await new Promise(L=>{V(()=>{a=vt(l),h.baseStyle.set(d,a),L()},{fast:n})}),await new Promise(L=>{V(()=>{let S=Ge(t),C=S.width,v=S.height,k=Number.isFinite(e.width),$=Number.isFinite(e.height),T=e.scale??1,N=typeof T=="number"&&T!==1;if(!N){let R=S.width/S.height;k&&$?(C=e.width,v=e.height):k?(C=e.width,v=C/R):$&&(v=e.height,C=v*R)}C=Math.max(1,Math.ceil(C)),v=Math.max(1,Math.ceil(v));let D=getComputedStyle(t),U=D.transform&&D.transform!=="none"?D.transform:"",q=Ze(t),u,p,g,w,m=0,y=0;if(Qe(t)){let R=nn({baseTransform:U,rotate:q.rotate||"0deg",scale:q.scale,translate:q.translate}),j=R.e??R.m41??0,et=R.f??R.m42??0;m=-j,y=-et;let Ct=R.is2D?Jt(R):Jt(new DOMMatrix(R.toString())),z=Je(C,v,Ct);u=Math.max(1,Math.ceil(z.width)),p=Math.max(1,Math.ceil(z.height)),g=-z.minX,w=-z.minY}else{let R=t.getBoundingClientRect(),j=tn(R,{top:0,right:0,bottom:0,left:0});u=Math.max(1,j.width),p=Math.max(1,j.height),g=-(j.x-Math.floor(R.left)),w=-(j.y-Math.floor(R.top))}let A="http://www.w3.org/2000/svg",b=document.createElementNS(A,"foreignObject");b.setAttribute("width","100%"),b.setAttribute("height","100%"),b.setAttribute("x",String(g)),b.setAttribute("y",String(w)),b.style.overflow="visible";let M=document.createElement("style");M.textContent=a+s+"svg{overflow:visible;} foreignObject{overflow:visible;}"+r,b.appendChild(M);let F=document.createElement("div");F.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),F.style.width=`${C}px`,F.style.height=`${v}px`,F.style.overflow="visible",F.style.transformOrigin="0 0";let I=[];if((m||y)&&I.push(`translate(${m}px, ${y}px)`),!N&&(k||$)){let R=S.width?C/S.width:1,j=S.height?v/S.height:1;I.push(`scale(${R}, ${j})`)}else N&&I.push(`scale(${T})`);I.length&&(F.style.transform=I.join(" ")),o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),o.style.transformOrigin="0 0",o.style.position="static",o.style.left="0",o.style.top="0",U&&(o.style.transform=U),o.style.rotate=q.rotate||"0deg",o.style.scale=q.scale||"1",o.style.translate=q.translate||"0 0",F.appendChild(o),b.appendChild(F);let E=new XMLSerializer().serializeToString(b);c=`<svg xmlns="${A}" width="${u}" height="${p}" viewBox="0 0 ${u} ${p}">`+E+"</svg>",f=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(c)}`,L()},{fast:n})});let x=document.getElementById("snapdom-sandbox");return x&&x.style.position==="absolute"&&x.remove(),f}function Ge(t){let e=getComputedStyle(t),n=i=>parseFloat(i)||0,o=n(e.width),r=n(e.height);return e.boxSizing==="content-box"&&(o+=n(e.paddingLeft)+n(e.paddingRight)+n(e.borderLeftWidth)+n(e.borderRightWidth),r+=n(e.paddingTop)+n(e.paddingBottom)+n(e.borderTopWidth)+n(e.borderBottomWidth)),{width:o,height:r}}function Ye(t){let e=getComputedStyle(t).transform;if(!e||e==="none")return new DOMMatrix;try{return new DOMMatrix(e)}catch{return new WebKitCSSMatrix(e)}}function Jt(t){return new DOMMatrix([t.a,t.b,t.c,t.d,0,0])}function Je(t,e,n){let r=[{x:0,y:0},{x:t,y:0},{x:0,y:e},{x:t,y:e}].map(c=>({x:n.a*c.x+n.c*c.y,y:n.b*c.x+n.d*c.y})),i=Math.min(...r.map(c=>c.x)),s=Math.max(...r.map(c=>c.x)),a=Math.min(...r.map(c=>c.y)),f=Math.max(...r.map(c=>c.y));return{minX:i,minY:a,width:s-i,height:f-a}}function Ze(t){let e={rotate:"0deg",scale:null,translate:null},n=t.computedStyleMap?.();if(n){let r=n.get("rotate");if(r){let a=r.angle??r;a&&"unit"in a?e.rotate=a.unit==="rad"?a.value*180/Math.PI+"deg":a.value+a.unit:e.rotate=String(r)}let i=n.get("scale");if(i&&i.length){let a=i[0]?.value??1,f=i[1]?.value??a;e.scale=`${a} ${f}`}let s=n.get("translate");if(s&&s.length){let a=s[0]?.value??0,f=s[1]?.value??0,c=s[0]?.unit??"px",l=s[1]?.unit??"px";e.translate=`${a}${c} ${f}${l}`}return e}let o=getComputedStyle(t);return e.rotate=o.rotate&&o.rotate!=="none"?o.rotate:"0deg",e.scale=o.scale&&o.scale!=="none"?o.scale:null,e.translate=o.translate&&o.translate!=="none"?o.translate:null,e}function Qe(t){let e=getComputedStyle(t).transform||"none";return!(e==="none"||e==="matrix(1, 0, 0, 1, 0, 0)"||/^matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*,/i.test(e))}function tn(t,e){let n=Math.floor(t.left-e.left),o=Math.floor(t.top-e.top),r=Math.ceil(t.width+e.left+e.right),i=Math.ceil(t.height+e.top+e.bottom);return{x:n,y:o,width:r,height:i}}var Ut=null;function en(){if(Ut)return Ut;let t=document.createElement("div");return t.id="snapdom-measure-slot",t.setAttribute("aria-hidden","true"),Object.assign(t.style,{position:"absolute",left:"-99999px",top:"0px",width:"0px",height:"0px",overflow:"hidden",opacity:"0",pointerEvents:"none",contain:"size layout style"}),document.documentElement.appendChild(t),Ut=t,t}function nn(t){let e=en(),n=document.createElement("div");n.style.transformOrigin="0 0",t.baseTransform&&(n.style.transform=t.baseTransform),t.rotate&&(n.style.rotate=t.rotate),t.scale&&(n.style.scale=t.scale),t.translate&&(n.style.translate=t.translate),e.appendChild(n);let o=Ye(n);return e.removeChild(n),o}function on(t){if(typeof t=="string"){let e=t.toLowerCase().trim();if(e==="disabled"||e==="full"||e==="auto"||e==="soft")return e}return"soft"}function Qt(t={}){let e=t.format??"png",n=on(t.cache);return{debug:t.debug??!1,fast:t.fast??!0,scale:t.scale??1,exclude:t.exclude??[],filter:t.filter??null,placeholders:t.placeholders!==!1,embedFonts:t.embedFonts??!1,iconFonts:Array.isArray(t.iconFonts)?t.iconFonts:t.iconFonts?[t.iconFonts]:[],localFonts:Array.isArray(t.localFonts)?t.localFonts:[],excludeFonts:t.excludeFonts??void 0,defaultImageUrl:t.defaultImageUrl??void 0,cache:n,useProxy:typeof t.useProxy=="string"?t.useProxy:"",width:t.width??null,height:t.height??null,format:e,type:t.type??"svg",quality:t.quality??.92,dpr:t.dpr??(window.devicePixelRatio||1),backgroundColor:t.backgroundColor??(["jpg","jpeg","webp"].includes(e)?"#ffffff":null),filename:t.filename??"snapDOM"}}async function te(t,e){let n=new Image;return n.src=t,await n.decode(),e.scale!==1&&(n.style.width=`${n.naturalWidth*e.scale}px`,n.style.height=`${n.naturalHeight*e.scale}px`),n}async function K(t,e){let{scale:n,dpr:o}=e,r=X(),i=new Image;i.crossOrigin="anonymous",i.loading="eager",i.decoding="sync",i.src=t;let s=null;r&&(s=document.createElement("div"),s.setAttribute("aria-hidden","true"),s.style.cssText="position:absolute;left:-99999px;top:0;width:0;height:0;overflow:hidden;opacity:0;pointer-events:none;contain:size layout style;",document.body.appendChild(s),s.appendChild(i)),await i.decode(),r&&await new Promise(d=>setTimeout(d,100));let a=i.naturalWidth*n,f=i.naturalHeight*n,c=document.createElement("canvas");c.width=Math.ceil(a*o),c.height=Math.ceil(f*o),c.style.width=`${a}px`,c.style.height=`${f}px`;let l=c.getContext("2d");if(o!==1&&l.scale(o,o),l.drawImage(i,0,0,a,f),s&&s.parentNode)try{s.parentNode.removeChild(s)}catch{}return c}async function xt(t,e){let n=e.type;if(n==="svg"){let i=decodeURIComponent(t.split(",")[1]);return new Blob([i],{type:"image/svg+xml"})}let o=await K(t,e),r=e.backgroundColor?Y(o,e.backgroundColor):o;return new Promise(i=>r.toBlob(s=>i(s),`image/${n}`,e.quality))}async function ee(t,e){let n=await K(t,e),o=e.backgroundColor?Y(n,e.backgroundColor):n,r=new Image;return r.src=o.toDataURL(`image/${e.format}`,e.quality),await r.decode(),r.style.width=`${o.width/e.dpr}px`,r.style.height=`${o.height/e.dpr}px`,r}async function ne(t,e){if(e.format==="svg"){let i=await xt(t,{...e,type:"svg"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=e.filename,a.click(),URL.revokeObjectURL(s);return}let n=await K(t,e),o=e.backgroundColor?Y(n,e.backgroundColor):n,r=document.createElement("a");r.href=o.toDataURL(`image/${e.format}`,e.quality),r.download=e.filename,r.click()}var oe=Symbol("snapdom.internal");async function _(t,e){if(!t)throw new Error("Element cannot be null or undefined");let n=Qt(e);return n.iconFonts&&n.iconFonts.length>0&&zt(n.iconFonts),n.snap||(n.snap={toPng:(o,r)=>_.toPng(o,r),toImg:(o,r)=>_.toImg(o,r)}),_.capture(t,n,oe)}_.capture=async(t,e,n)=>{if(n!==oe)throw new Error("[snapdom.capture] is internal. Use snapdom(...) instead.");let o=await Zt(t,e),r=s=>({...e,...s||{}}),i=s=>a=>{let f=r({...a||{},format:s}),c=s==="jpeg"||s==="jpg",l=f.backgroundColor==null||f.backgroundColor==="transparent";return c&&l&&(f.backgroundColor="#ffffff"),ee(o,f)};return{url:o,toRaw:()=>o,toImg:s=>te(o,r(s)),toCanvas:s=>K(o,r(s)),toBlob:s=>xt(o,r(s)),toPng:i("png"),toJpg:i("jpeg"),toWebp:i("webp"),download:s=>ne(o,r(s))}};_.toRaw=(t,e)=>_(t,e).then(n=>n.toRaw());_.toImg=(t,e)=>_(t,e).then(n=>n.toImg());_.toCanvas=(t,e)=>_(t,e).then(n=>n.toCanvas());_.toBlob=(t,e)=>_(t,e).then(n=>n.toBlob());_.toPng=(t,e)=>_(t,{...e,format:"png"}).then(n=>n.toPng());_.toJpg=(t,e)=>_(t,{...e,format:"jpeg"}).then(n=>n.toJpg());_.toWebp=(t,e)=>_(t,{...e,format:"webp"}).then(n=>n.toWebp());_.download=(t,e)=>_(t,e).then(n=>n.download());async function rn(t=document,e={}){let{embedFonts:n=!0,cacheOpt:o="full",useProxy:r=""}=e;lt(o);try{await document.fonts.ready}catch{}$t(),h.session=h.session||{},h.session.styleCache||(h.session.styleCache=new WeakMap);try{await St(t,void 0,h.session.styleCache,{useProxy:r})}catch{}let i=[],s=[];try{t?.querySelectorAll&&(i=Array.from(t.querySelectorAll("img[src]")),s=Array.from(t.querySelectorAll("*")))}catch{}let a=[];for(let f of i){let c=f?.src;if(c&&!h.image.has(c)){let l=Promise.resolve().then(()=>O(c,{as:"dataURL",useProxy:r})).then(d=>{h.image.set(c,d)}).catch(()=>{});a.push(l)}}for(let f of s){let c="";try{c=Z(f).backgroundImage}catch{}if(c&&c!=="none"){let l=Q(c);for(let d of l)if(d.startsWith("url(")){let x=Promise.resolve().then(()=>J(d,{...e,useProxy:r})).catch(()=>{});a.push(x)}}}if(n)try{let f=gt(t),c=yt(t);if(typeof X=="function"?X():X){let l=new Set(Array.from(f).map(d=>String(d).split("__")[0]).filter(Boolean));await wt(l,2)}await pt({required:f,usedCodepoints:c,exclude:e.excludeFonts,localFonts:e.localFonts,useProxy:e.useProxy??r})}catch{}await Promise.allSettled(a)}export{rn as preCache,_ as snapdom};
