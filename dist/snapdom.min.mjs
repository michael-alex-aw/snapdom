var l={image:new Map,background:new Map,resource:new Map,defaultStyle:new Map,baseStyle:new Map,computedStyle:new WeakMap,font:new Set,snapshot:new WeakMap,snapshotKey:new Map,preStyleMap:new Map,preStyle:new WeakMap,preNodeMap:new Map,reset:Ne};function Ne(){l.computedStyle=new WeakMap,l.snapshot=new WeakMap,l.snapshotKey.clear(),l.preStyleMap.clear(),l.preStyle=new WeakMap,l.preNodeMap.clear()}var Te=["div","span","p","a","img","ul","li","button","input","select","textarea","label","section","article","header","footer","nav","main","aside","h1","h2","h3","h4","h5","h6","svg","path","circle","rect","line","g","table","thead","tbody","tr","td","th"];function ie(){for(let e of Te)ce(e)}function ce(e){if(l.defaultStyle.has(e))return l.defaultStyle.get(e);if(new Set(["script","style","meta","link","noscript","template"]).has(e)){let i={};return l.defaultStyle.set(e,i),i}let r=document.getElementById("snapdom-sandbox");r||(r=document.createElement("div"),r.id="snapdom-sandbox",r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",r.style.width="0",r.style.height="0",r.style.overflow="hidden",document.body.appendChild(r));let c=document.createElement(e);c.style.all="initial",r.appendChild(c);let a=getComputedStyle(c),n={};for(let i of a)n[i]=a.getPropertyValue(i);return r.removeChild(c),l.defaultStyle.set(e,n),n}function U(e,t,r=!1){let c=[],a=ce(t);for(let[n,i]of Object.entries(e))if(!r)i&&c.push(`${n}:${i}`);else{let o=a[n];i&&i!==o&&c.push(`${n}:${i}`)}return c.sort().join(";")}function le(e){let t=new Set;return e.nodeType!==Node.ELEMENT_NODE&&e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE?[]:(e.tagName&&t.add(e.tagName.toLowerCase()),typeof e.querySelectorAll=="function"&&e.querySelectorAll("*").forEach(r=>t.add(r.tagName.toLowerCase())),Array.from(t))}function de(e){let t=new Map;for(let c of e){let a=l.defaultStyle.get(c);if(!a)continue;let n=Object.entries(a).map(([i,o])=>`${i}:${o};`).sort().join("");t.has(n)||t.set(n,[]),t.get(n).push(c)}let r="";for(let[c,a]of t.entries())r+=`${a.join(",")} { ${c} }
`;return r}function fe(){let e=new Set(l.preStyleMap.values()),t=new Map,r=1;for(let c of e)t.set(c,`c${r++}`);return t}async function M(e,t={}){let r=D(e),c=/^((repeating-)?(linear|radial|conic)-gradient)\(/i.test(e);if(r){let a=K(r);if(l.background.has(a))return t.skipInline?void 0:`url(${l.background.get(a)})`;{let n=await A(a,{useProxy:t.useProxy});return l.background.set(a,n),t.skipInline?void 0:`url("${n}")`}}return e}function L(e,{fast:t=!1}={}){if(t)return e();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:50}):setTimeout(e,1)}function $(e,t=null){if(!(e instanceof Element))return window.getComputedStyle(e,t);let r=l.computedStyle.get(e);if(r||(r=new Map,l.computedStyle.set(e,r)),!r.has(t)){let c=window.getComputedStyle(e,t);r.set(t,c)}return r.get(t)}function ue(e){let t=e.replace(/^['"]|['"]$/g,"");if(t.startsWith("\\"))try{return String.fromCharCode(parseInt(t.replace("\\",""),16))}catch{return t}return t}function D(e){let t=e.match(/url\((['"]?)(.*?)(\1)\)/);if(!t)return null;let r=t[2].trim();return r.startsWith("#")?null:r}function A(e,{timeout:t=3e3,useProxy:r=""}={}){function c(d){try{return new URL(d,window.location.href).origin===window.location.origin?"use-credentials":"anonymous"}catch{return"anonymous"}}async function a(d){let m=f=>fetch(f,{mode:"cors",credentials:c(f)==="use-credentials"?"include":"omit"}).then(h=>h.blob()).then(h=>new Promise((u,p)=>{let g=new FileReader;g.onloadend=()=>{let w=g.result;if(typeof w!="string"||!w.startsWith("data:image/")){p(new Error("Invalid image data URL"));return}u(w)},g.onerror=()=>p(new Error("FileReader error")),g.readAsDataURL(h)}));try{return await m(d)}catch{if(r&&typeof r=="string"){let h=r.replace(/\/$/,"")+"/"+K(d);try{return await m(h)}catch{throw new Error("[SnapDOM - fetchImage] CORS restrictions prevented image capture (even via proxy)")}}else throw new Error("[SnapDOM - fetchImage] Fetch fallback failed and no proxy provided")}}let n=c(e);if(l.image.has(e))return Promise.resolve(l.image.get(e));if(e.startsWith("data:image/"))return l.image.set(e,e),Promise.resolve(e);let o=e+(e.includes("?")?"&":"?")+`v=${Date.now()}`;return/\.svg(\?.*)?$/i.test(e)?(async()=>{try{let m=await(await fetch(o,{mode:"cors",credentials:n==="use-credentials"?"include":"omit"})).text(),f=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(m)}`;return l.image.set(e,f),f}catch{return a(o)}})():new Promise((d,m)=>{let f=setTimeout(()=>{m(new Error("[SnapDOM - fetchImage] Image load timed out"))},t),h=new Image;h.crossOrigin=n,h.onload=async()=>{clearTimeout(f);try{await h.decode();let u=document.createElement("canvas");u.width=h.width,u.height=h.height,u.getContext("2d").drawImage(h,0,0,u.width,u.height);let g=u.toDataURL("image/png");l.image.set(e,g),d(g)}catch{try{let u=await a(o);l.image.set(e,u),d(u)}catch(u){m(u)}}},h.onerror=async()=>{clearTimeout(f),console.error(`[SnapDOM - fetchImage] Image failed to load: ${e}`);try{let u=await a(o);l.image.set(e,u),d(u)}catch(u){m(u)}},h.src=o})}function Q(e){let t={};for(let r of e)t[r]=e.getPropertyValue(r);return t}function me(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function pe(e){if(!e||e==="none")return"";let t=e.replace(/translate[XY]?\([^)]*\)/g,"");return t=t.replace(/matrix\(([^)]+)\)/g,(r,c)=>{let a=c.split(",").map(n=>n.trim());return a.length!==6?`matrix(${c})`:(a[4]="0",a[5]="0",`matrix(${a.join(", ")})`)}),t=t.replace(/matrix3d\(([^)]+)\)/g,(r,c)=>{let a=c.split(",").map(n=>n.trim());return a.length!==16?`matrix3d(${c})`:(a[12]="0",a[13]="0",`matrix3d(${a.join(", ")})`)}),t.trim().replace(/\s{2,}/g," ")}function K(e){if(/%[0-9A-Fa-f]{2}/.test(e))return e;try{return encodeURI(e)}catch{return e}}function F(e){let t=[],r=0,c=0;for(let a=0;a<e.length;a++){let n=e[a];n==="("&&r++,n===")"&&r--,n===","&&r===0&&(t.push(e.slice(c,a).trim()),c=a+1)}return t.push(e.slice(c).trim()),t}function Ae(e){let t={};for(let r=0;r<e.length;r++){let c=e[r],a=e.getPropertyValue(c);(c==="background-image"||c==="content")&&a.includes("url(")&&!a.includes("data:")&&(a="none"),t[c]=a}return t}function Y(e,t,r){if(e.tagName==="STYLE")return;l.preStyle.has(e)||l.preStyle.set(e,$(e));let c=l.preStyle.get(e);if(!l.snapshot.has(e)){let s=Ae(c);l.snapshot.set(e,s)}let a=l.snapshot.get(e),n=Object.entries(a).sort(([s],[d])=>s.localeCompare(d)).map(([s,d])=>`${s}:${d}`).join(";");if(l.snapshotKey.has(n)){l.preStyleMap.set(t,l.snapshotKey.get(n));return}let i=e.tagName?.toLowerCase()||"div",o=U(a,i,r);l.snapshotKey.set(n,o),l.preStyleMap.set(t,o)}function W(e,t,r={},c){if(!e)throw new Error("Invalid node");let a=new Set,n=null;if(e.nodeType===Node.TEXT_NODE||e.nodeType!==Node.ELEMENT_NODE)return e.cloneNode(!0);if(e.getAttribute("data-capture")==="exclude"){let o=document.createElement("div"),s=e.getBoundingClientRect();return o.style.cssText=`display:inline-block;width:${s.width}px;height:${s.height}px;visibility:hidden;`,o}if(r.exclude&&Array.isArray(r.exclude))for(let o of r.exclude)try{if(e.matches?.(o)){let s=document.createElement("div"),d=e.getBoundingClientRect();return s.style.cssText=`display:inline-block;width:${d.width}px;height:${d.height}px;visibility:hidden;`,s}}catch(s){console.warn(`Invalid selector in exclude option: ${o}`,s)}if(typeof r.filter=="function")try{if(!r.filter(e,c||e)){let o=document.createElement("div"),s=e.getBoundingClientRect();return o.style.cssText=`display:inline-block;width:${s.width}px;height:${s.height}px;visibility:hidden;`,o}}catch(o){console.warn("Error in filter function:",o)}if(e.tagName==="IFRAME"){let o=document.createElement("div");return o.style.cssText=`width:${e.offsetWidth}px;height:${e.offsetHeight}px;background-image:repeating-linear-gradient(45deg,#ddd,#ddd 5px,#f9f9f9 5px,#f9f9f9 10px);display:flex;align-items:center;justify-content:center;font-size:12px;color:#555;border:1px solid #aaa;`,o}if(e.getAttribute("data-capture")==="placeholder"){let o=e.cloneNode(!1);l.preNodeMap.set(o,e),Y(e,o,t);let s=document.createElement("div");return s.textContent=e.getAttribute("data-placeholder-text")||"",s.style.cssText="color:#666;font-size:12px;text-align:center;line-height:1.4;padding:0.5em;box-sizing:border-box;",o.appendChild(s),o}if(e.tagName==="CANVAS"){let o=e.toDataURL(),s=document.createElement("img");return s.src=o,s.width=e.width,s.height=e.height,l.preNodeMap.set(s,e),Y(e,s,t),s}let i;try{i=e.cloneNode(!1),l.preNodeMap.set(i,e)}catch(o){throw console.error("[Snapdom] Failed to clone node:",e,o),o}if(e instanceof HTMLTextAreaElement){i.textContent=e.value,i.value=e.value;let o=e.getBoundingClientRect();return i.style.width=`${o.width}px`,i.style.height=`${o.height}px`,i}if(e instanceof HTMLInputElement&&(i.value=e.value,i.setAttribute("value",e.value),e.checked!==void 0&&(i.checked=e.checked,e.checked&&i.setAttribute("checked",""),e.indeterminate&&(i.indeterminate=e.indeterminate))),e instanceof HTMLSelectElement&&(n=e.value),Y(e,i,t),e.shadowRoot)if(Array.from(e.shadowRoot.querySelectorAll("slot")).length>0){for(let s of e.shadowRoot.childNodes)if(s.nodeType===Node.ELEMENT_NODE&&s.tagName==="STYLE"){let d=s.textContent||"";d.trim()&&t&&(l.preStyle||(l.preStyle=new WeakMap),l.preStyle.set(s,d))}}else{let s=document.createDocumentFragment();for(let d of e.shadowRoot.childNodes){if(d.nodeType===Node.ELEMENT_NODE&&d.tagName==="STYLE"){let f=d.textContent||"";f.trim()&&t&&(l.preStyle||(l.preStyle=new WeakMap),l.preStyle.set(d,f));continue}let m=W(d,t,r,c||e);m&&s.appendChild(m)}i.appendChild(s)}if(e.tagName==="SLOT"){let o=e.assignedNodes?.({flatten:!0})||[],s=o.length>0?o:Array.from(e.childNodes),d=document.createDocumentFragment();for(let m of s){let f=W(m,t,r,c||e);f&&d.appendChild(f)}return d}for(let o of e.childNodes){if(a.has(o))continue;let s=W(o,t,r,c||e);s&&i.appendChild(s)}if(n!==null&&i instanceof HTMLSelectElement){i.value=n;for(let o of i.options)o.value===n?o.setAttribute("selected",""):o.removeAttribute("selected")}return i}var Me=[/font\s*awesome/i,/material\s*icons/i,/ionicons/i,/glyphicons/i,/feather/i,/bootstrap\s*icons/i,/remix\s*icons/i,/heroicons/i,/layui/i,/lucide/i],Z=[];function he(e){let t=Array.isArray(e)?e:[e];for(let r of t)r instanceof RegExp?Z.push(r):typeof r=="string"?Z.push(new RegExp(r,"i")):console.warn("[snapdom] Ignored invalid iconFont value:",r)}function v(e){let t=typeof e=="string"?e:"",r=[...Me,...Z];for(let c of r)if(c instanceof RegExp&&c.test(t))return!0;return!!(/icon/i.test(t)||/glyph/i.test(t)||/symbols/i.test(t)||/feather/i.test(t)||/fontawesome/i.test(t))}async function ge(e,t,r,c=32,a="#000"){t=t.replace(/^['"]+|['"]+$/g,"");let n=window.devicePixelRatio||1,o=document.createElement("canvas").getContext("2d");o.font=r?`${r} ${c}px "${t}"`:`${c}px "${t}"`;let s=o.measureText(e),d=s.actualBoundingBoxAscent||c*.8,m=s.actualBoundingBoxDescent||c*.2,f=d+m,h=s.width,u=document.createElement("canvas");u.width=Math.ceil(h*n),u.height=Math.ceil(f*n);let p=u.getContext("2d");return p.scale(n,n),p.font=o.font,p.textAlign="left",p.textBaseline="alphabetic",p.fillStyle=a,p.fillText(e,0,d),u.toDataURL()}function ye(e){return Array.from(document.styleSheets).some(t=>t.href===e)}function Le(e){return new Promise(t=>{if(ye(e))return t(null);let r=document.createElement("link");r.rel="stylesheet",r.href=e,r.setAttribute("data-snapdom","injected-import"),r.onload=()=>t(r),r.onerror=()=>t(null),document.head.appendChild(r)})}async function X({preCached:e=!1}={}){if(l.resource.has("fonts-embed-css")){if(e){let n=document.createElement("style");n.setAttribute("data-snapdom","embedFonts"),n.textContent=l.resource.get("fonts-embed-css"),document.head.appendChild(n)}return l.resource.get("fonts-embed-css")}let t=/@import\s+url\(["']?([^"')]+)["']?\)/g,r=[];for(let n of document.querySelectorAll("style")){let i=n.textContent||"",o=Array.from(i.matchAll(t));for(let s of o){let d=s[1];v(d)||ye(d)||r.push(d)}}await Promise.all(r.map(Le));let c=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(n=>n.href),a="";for(let n of c)try{let o=await(await fetch(n.href)).text();if(v(n.href)||v(o))continue;let s=/url\((["']?)([^"')]+)\1\)/g,d=await Promise.all(Array.from(o.matchAll(s)).map(async f=>{let h=D(f[0]);if(!h)return null;let u=h;if(!u.startsWith("http")&&!u.startsWith("data:")&&(u=new URL(u,n.href).href),v(u))return null;if(l.resource.has(u))return l.font.add(u),{original:f[0],inlined:`url(${l.resource.get(u)})`};if(l.font.has(u))return null;try{let g=await(await fetch(u)).blob(),w=await new Promise(y=>{let C=new FileReader;C.onload=()=>y(C.result),C.readAsDataURL(g)});return l.resource.set(u,w),l.font.add(u),{original:f[0],inlined:`url(${w})`}}catch{return console.warn("[snapdom] Failed to fetch font resource:",u),null}})),m=o;for(let f of d)f&&(m=m.replace(f.original,f.inlined));a+=m+`
`}catch{console.warn("[snapdom] Failed to fetch CSS:",n.href)}for(let n of document.styleSheets)try{if(!n.href||c.every(i=>i.href!==n.href)){for(let i of n.cssRules)if(i.type===CSSRule.FONT_FACE_RULE){let o=i.style.getPropertyValue("src"),s=i.style.getPropertyValue("font-family");if(!o||v(s))continue;let d=/url\((["']?)([^"')]+)\1\)/g,m=/local\((["']?)[^)]+?\1\)/g,f=!!o.match(d),h=!!o.match(m);if(!f&&h){a+=`@font-face{font-family:${s};src:${o};font-style:${i.style.getPropertyValue("font-style")||"normal"};font-weight:${i.style.getPropertyValue("font-weight")||"normal"};}`;continue}let u=o,p=Array.from(o.matchAll(d));for(let g of p){let w=g[2].trim();if(!w)continue;let y=w;if(!y.startsWith("http")&&!y.startsWith("data:")&&(y=new URL(y,n.href||location.href).href),!v(y)){if(l.resource.has(y)){l.font.add(y),u=u.replace(g[0],`url(${l.resource.get(y)})`);continue}if(!l.font.has(y))try{let I=await(await fetch(y)).blob(),R=await new Promise(N=>{let E=new FileReader;E.onload=()=>N(E.result),E.readAsDataURL(I)});l.resource.set(y,R),l.font.add(y),u=u.replace(g[0],`url(${R})`)}catch{console.warn("[snapdom] Failed to fetch font URL:",y)}}}a+=`@font-face{font-family:${s};src:${u};font-style:${i.style.getPropertyValue("font-style")||"normal"};font-weight:${i.style.getPropertyValue("font-weight")||"normal"};}`}}}catch(i){console.warn("[snapdom] Cannot access stylesheet",n.href,i)}for(let n of document.fonts)if(n.family&&n.status==="loaded"&&n._snapdomSrc){if(v(n.family))continue;let i=n._snapdomSrc;if(!i.startsWith("data:")){if(l.resource.has(n._snapdomSrc))i=l.resource.get(n._snapdomSrc),l.font.add(n._snapdomSrc);else if(!l.font.has(n._snapdomSrc))try{let s=await(await fetch(n._snapdomSrc)).blob();i=await new Promise(d=>{let m=new FileReader;m.onload=()=>d(m.result),m.readAsDataURL(s)}),l.resource.set(n._snapdomSrc,i),l.font.add(n._snapdomSrc)}catch{console.warn("[snapdom] Failed to fetch dynamic font src:",n._snapdomSrc);continue}}a+=`@font-face{font-family:'${n.family}';src:url(${i});font-style:${n.style||"normal"};font-weight:${n.weight||"normal"};}`}if(a&&(l.resource.set("fonts-embed-css",a),e)){let n=document.createElement("style");n.setAttribute("data-snapdom","embedFonts"),n.textContent=a,document.head.appendChild(n)}return a}async function ee(e,t,r,c=!1,a){if(!(e instanceof Element)||!(t instanceof Element))return;for(let o of["::before","::after","::first-letter"])try{let s=$(e,o);if(!s||typeof s[Symbol.iterator]!="function"||s.content==="none"&&s.backgroundImage==="none"&&s.backgroundColor==="transparent"&&(s.borderStyle==="none"||parseFloat(s.borderWidth)===0)&&(!s.transform||s.transform==="none")&&s.display==="inline")continue;if(o==="::first-letter"){let b=getComputedStyle(e);if(!(s.color!==b.color||s.fontSize!==b.fontSize||s.fontWeight!==b.fontWeight))continue;let B=Array.from(t.childNodes).find(se=>se.nodeType===Node.TEXT_NODE&&se.textContent?.trim().length>0);if(!B)continue;let re=B.textContent,H=re.match(/^([^\p{L}\p{N}\s]*[\p{L}\p{N}](?:['â€™])?)/u)?.[0],$e=re.slice(H?.length||0);if(!H||/[\uD800-\uDFFF]/.test(H))continue;let z=document.createElement("span");z.textContent=H,z.dataset.snapdomPseudo="::first-letter";let Ie=Q(s),Re=U(Ie,"span",r);l.preStyleMap.set(z,Re);let ae=document.createTextNode($e);t.replaceChild(ae,B),t.insertBefore(z,ae);continue}let m=s.content,f=/counter\s*\(|counters\s*\(/.test(m)?"- ":ue(m),h=s.backgroundImage,u=s.backgroundColor,p=s.fontFamily,g=parseInt(s.fontSize)||32,w=parseInt(s.fontWeight)||!1,y=s.color||"#000",C=s.display,I=parseFloat(s.width),R=parseFloat(s.height),N=s.borderStyle,E=parseFloat(s.borderWidth),P=s.transform,G=v(p),j=m!=="none"&&f!=="",O=h&&h!=="none",_=u&&u!=="transparent"&&u!=="rgba(0, 0, 0, 0)",T=C!=="inline"&&(I>0||R>0),V=N&&N!=="none"&&E>0,q=P&&P!=="none";if(!(j||O||_||T||V||q))continue;let S=document.createElement("span");S.dataset.snapdomPseudo=o;let J=Q(s),ke=U(J,"span",r);if(l.preStyleMap.set(S,ke),G&&f.length===1){let b=document.createElement("img");b.src=await ge(f,p,w,g,y),b.style=`width:${g}px;height:auto;object-fit:contain;`,S.appendChild(b)}else if(f.startsWith("url(")){let b=D(f);if(b?.trim())try{let k=document.createElement("img"),B=await A(K(b,{useProxy:a}));k.src=B,k.style=`width:${g}px;height:auto;object-fit:contain;`,S.appendChild(k)}catch(k){console.error(`[snapdom] Error in pseudo ${o} for`,e,k)}}else!G&&j&&(S.textContent=f);if(O)try{let b=F(h),k=await Promise.all(b.map(M));S.style.backgroundImage=k.join(", ")}catch(b){console.warn(`[snapdom] Failed to inline background-image for ${o}`,b)}if(_&&(S.style.backgroundColor=u),!(S.childNodes.length>0||S.textContent?.trim()!==""||O||_||T||V||q))continue;o==="::before"?t.insertBefore(S,t.firstChild):t.appendChild(S)}catch(s){console.warn(`[snapdom] Failed to capture ${o} for`,e,s)}let n=Array.from(e.children),i=Array.from(t.children).filter(o=>!o.dataset.snapdomPseudo);for(let o=0;o<Math.min(n.length,i.length);o++)await ee(n[o],i[o],r,c,a)}function we(e){if(!e)return;let t=document.querySelectorAll("svg > defs");t.length&&e.querySelectorAll("svg").forEach(r=>{let c=r.querySelectorAll("use");if(!c.length)return;let a=new Set;if(c.forEach(i=>{let o=i.getAttribute("xlink:href")||i.getAttribute("href");o&&o.startsWith("#")&&a.add(o.slice(1))}),!a.size)return;let n=document.createElementNS("http://www.w3.org/2000/svg","defs");for(let i of a)for(let o of t){let s=o.querySelector(`#${CSS.escape(i)}`);if(s){n.appendChild(s.cloneNode(!0));break}}n.childNodes.length&&r.insertBefore(n,r.firstChild)})}async function xe(e,t=!1,r=!1,c={}){let a,n="";try{a=W(e,t,c,e)}catch(i){throw console.warn("deepClone failed:",i),i}try{await ee(e,a,t,r,c.useProxy)}catch(i){console.warn("inlinePseudoElements failed:",i)}try{we(a)}catch(i){console.warn("inlineExternalDef failed:",i)}if(t){let i=fe();n=Array.from(i.entries()).map(([o,s])=>`.${s}{${o}}`).join("");for(let[o,s]of l.preStyleMap.entries()){if(o.tagName==="STYLE")continue;let d=i.get(s);d&&o.classList.add(d);let m=o.style?.backgroundImage;o.removeAttribute("style"),m&&m!=="none"&&(o.style.backgroundImage=m)}}else for(let[i,o]of l.preStyleMap.entries())i.tagName!=="STYLE"&&i.setAttribute("style",o.replace(/;/g,"; "));for(let[i,o]of l.preNodeMap.entries()){let s=o.scrollLeft,d=o.scrollTop;if((s||d)&&i instanceof HTMLElement){i.style.overflow="hidden",i.style.scrollbarWidth="none",i.style.msOverflowStyle="none";let f=document.createElement("div");for(f.style.transform=`translate(${-s}px, ${-d}px)`,f.style.willChange="transform",f.style.display="inline-block",f.style.width="100%";i.firstChild;)f.appendChild(i.firstChild);i.appendChild(f)}}if(e===l.preNodeMap.get(a)){let i=l.preStyle.get(e)||window.getComputedStyle(e);l.preStyle.set(e,i);let o=pe(i.transform);a.style.margin="0",a.style.position="static",a.style.top="auto",a.style.left="auto",a.style.right="auto",a.style.bottom="auto",a.style.zIndex="auto",a.style.float="none",a.style.clear="none",a.style.transform=o||""}for(let[i,o]of l.preNodeMap.entries())o.tagName==="PRE"&&(i.style.marginTop="0",i.style.marginBlockStart="0");return{clone:a,classCSS:n}}async function be(e,t={}){let r=Array.from(e.querySelectorAll("img")),c=async a=>{let n=a.src;try{let i=await A(n,{useProxy:t.useProxy});a.src=i,a.width||(a.width=a.naturalWidth||100),a.height||(a.height=a.naturalHeight||100)}catch{let i=document.createElement("div");i.style=`width: ${a.width||100}px; height: ${a.height||100}px; background: #ccc; display: inline-block; text-align: center; line-height: ${a.height||100}px; color: #666; font-size: 12px;`,i.innerText="img",a.replaceWith(i)}};for(let a=0;a<r.length;a+=4){let n=r.slice(a,a+4).map(c);await Promise.allSettled(n)}}async function Se(e,t,r={}){let c=[[e,t]],a=["background-image","mask","mask-image","-webkit-mask-image","mask-source","mask-box-image-source","mask-border-source","-webkit-mask-box-image-source","border-image","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat"];for(;c.length;){let[n,i]=c.shift(),o=l.preStyle.get(n)||$(n);l.preStyle.has(n)||l.preStyle.set(n,o);for(let f of a){let h=o.getPropertyValue(f);if(!h||h==="none")continue;let u=F(h),p=await Promise.all(u.map(g=>M(g,r)));p.some(g=>g&&g!=="none"&&!/^url\(undefined/.test(g))&&i.style.setProperty(f,p.join(", "))}let s=o.getPropertyValue("background-color");s&&s!=="transparent"&&s!=="rgba(0, 0, 0, 0)"&&(i.style.backgroundColor=s);let d=Array.from(n.children),m=Array.from(i.children);for(let f=0;f<Math.min(d.length,m.length);f++)c.push([d[f],m[f]])}}async function Ce(e,t={}){if(!e)throw new Error("Element cannot be null or undefined");l.reset();let{compress:r=!0,embedFonts:c=!1,fast:a=!0,scale:n=1,useProxy:i=""}=t,o,s,d="",m="",f,h;if({clone:o,classCSS:s}=await xe(e,r,c,t),await new Promise(p=>{L(async()=>{await be(o,t),p()},{fast:a})}),await new Promise(p=>{L(async()=>{await Se(e,o,t),p()},{fast:a})}),c&&await new Promise(p=>{L(async()=>{d=await X(),p()},{fast:a})}),r){let p=le(o).sort(),g=p.join(",");l.baseStyle.has(g)?m=l.baseStyle.get(g):await new Promise(w=>{L(()=>{m=de(p),l.baseStyle.set(g,m),w()},{fast:a})})}await new Promise(p=>{L(()=>{let g=e.getBoundingClientRect(),w=g.width,y=g.height,C=Number.isFinite(t.width),I=Number.isFinite(t.height),R=typeof n=="number"&&n!==1;if(!R){let T=g.width/g.height;C&&I?(w=t.width,y=t.height):C?(w=t.width,y=w/T):I&&(y=t.height,w=y*T)}if(w=Math.ceil(w),y=Math.ceil(y),o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),o.style.transformOrigin="top left",!R&&(C||I)){let T=g.width,V=g.height,q=w/T,oe=y/V,S=o.style.transform||"",J=`scale(${q}, ${oe})`;o.style.transform=`${J} ${S}`.trim()}let N="http://www.w3.org/2000/svg",E=document.createElementNS(N,"foreignObject");E.setAttribute("width","100%"),E.setAttribute("height","100%");let P=document.createElement("style");P.textContent=m+d+"svg{overflow:visible;}"+s,E.appendChild(P),E.appendChild(o);let j=new XMLSerializer().serializeToString(E);h=`<svg xmlns="${N}" width="${w}" height="${y}" viewBox="0 0 ${w} ${y}">`+j+"</svg>",f=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(h)}`,p()},{fast:a})});let u=document.getElementById("snapdom-sandbox");return u&&u.style.position==="absolute"&&u.remove(),f}async function Fe(e,{scale:t=1}={}){let r=new Image;return r.src=e,await r.decode(),t!==1&&(r.style.width=`${r.naturalWidth*t}px`,r.style.height=`${r.naturalHeight*t}px`),r}async function Ee(e,{dpr:t=1,scale:r=1}={}){let c=new Image;c.src=e,c.crossOrigin="anonymous",c.loading="eager",c.decoding="sync";let a=me(),n=!1;if(a&&(document.body.appendChild(c),n=!0),await c.decode(),a&&await new Promise(m=>setTimeout(m,100)),c.width===0||c.height===0)throw n&&c.remove(),new Error("Image failed to load or has no dimensions");let i=c.naturalWidth*r,o=c.naturalHeight*r,s=document.createElement("canvas");s.width=Math.ceil(i*t),s.height=Math.ceil(o*t),s.style.width=`${i}px`,s.style.height=`${o}px`;let d=s.getContext("2d");return d.scale(t,t),d.drawImage(c,0,0,i,o),n&&c.remove(),s}async function ve(e,{type:t="svg",scale:r=1,backgroundColor:c="#fff",quality:a}={}){let n={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",webp:"image/webp"}[t]||"image/png";if(t==="svg"){let o=decodeURIComponent(e.split(",")[1]);return new Blob([o],{type:"image/svg+xml"})}let i=await ne(e,{dpr:1,scale:r},c);return new Promise(o=>{i.toBlob(s=>o(s),`${n}`,a)})}async function ne(e,{dpr:t=1,scale:r=1},c){let a=await Ee(e,{dpr:t,scale:r});if(!c)return a;let n=document.createElement("canvas");n.width=a.width,n.height=a.height;let i=n.getContext("2d");return i.fillStyle=c,i.fillRect(0,0,n.width,n.height),i.drawImage(a,0,0),n}async function te(e,{dpr:t=1,scale:r=1,backgroundColor:c,quality:a},n="png"){let i=["jpg","jpeg","webp"].includes(n)?"#fff":void 0,s=await ne(e,{dpr:t,scale:r},c??i),d=new Image;return d.src=s.toDataURL(`image/${n}`,a),await d.decode(),d.style.width=`${s.width/t}px`,d.style.height=`${s.height/t}px`,d}async function Pe(e,{dpr:t=1,scale:r=1,backgroundColor:c,format:a="png",filename:n="snapDOM"}={}){if(a==="svg"){let h=await ve(e),u=URL.createObjectURL(h),p=document.createElement("a");p.href=u,p.download=`${n}.svg`,p.click(),URL.revokeObjectURL(u);return}let i=["jpg","jpeg","webp"].includes(a)?"#fff":void 0,s=await ne(e,{dpr:t,scale:r},c??i),d={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",webp:"image/webp"}[a]||"image/png",m=s.toDataURL(d),f=document.createElement("a");f.href=m,f.download=`${n}.${a}`,f.click()}async function x(e,t={}){if(t={scale:1,...t},!e)throw new Error("Element cannot be null or undefined");return t.iconFonts&&he(t.iconFonts),await x.capture(e,t)}x.capture=async(e,t={})=>{let r=await Ce(e,t),c=t.dpr??(window.devicePixelRatio||1),a=t.scale||1;return{url:r,options:t,toRaw:()=>r,toImg:(n={})=>Fe(r,{dpr:c,scale:a,...n}),toCanvas:(n={})=>Ee(r,{dpr:c,scale:a,...n}),toBlob:(n={})=>ve(r,{dpr:c,scale:a,...n}),toPng:(n={})=>te(r,{dpr:c,scale:a,...n},"png"),toJpg:(n={})=>te(r,{dpr:c,scale:a,...n},"jpeg"),toWebp:(n={})=>te(r,{dpr:c,scale:a,...n},"webp"),download:({format:n="png",filename:i="snapDOM",backgroundColor:o,...s}={})=>Pe(r,{dpr:c,scale:a,format:n,filename:i,backgroundColor:o,...s})}};x.toRaw=async(e,t)=>(await x.capture(e,t)).toRaw();x.toImg=async(e,t)=>(await x.capture(e,t)).toImg();x.toCanvas=async(e,t)=>(await x.capture(e,t)).toCanvas();x.toBlob=async(e,t)=>(await x.capture(e,t)).toBlob(t);x.toPng=async(e,t)=>(await x.capture(e,t)).toPng(t);x.toJpg=async(e,t)=>(await x.capture(e,t)).toJpg(t);x.toWebp=async(e,t)=>(await x.capture(e,t)).toWebp(t);x.download=async(e,t={})=>{let{format:r="png",filename:c="capture",backgroundColor:a,...n}=t;return await(await x.capture(e,n)).download({format:r,filename:c,backgroundColor:a})};async function Be(e=document,t={}){let{embedFonts:r=!0,reset:c=!1}=t;if(c){l.reset();return}await document.fonts.ready,ie();let a=[],n=[];e?.querySelectorAll&&(a=Array.from(e.querySelectorAll("img[src]")),n=Array.from(e.querySelectorAll("*")));let i=[];for(let o of a){let s=o.src;l.image.has(s)||i.push(A(s,{useProxy:t.useProxy}).then(d=>l.image.set(s,d)).catch(()=>{}))}for(let o of n){let s=$(o).backgroundImage;if(s&&s!=="none"){let d=F(s);for(let m of d)m.startsWith("url(")&&i.push(M(m,t).catch(()=>{}))}}r&&await X({preCached:!0}),await Promise.all(i)}export{Be as preCache,x as snapdom};
